---
stepsCompleted: [1, 2, 3, 4]
inputDocuments: ["specs/prd.md", "specs/product-brief.md", "specs/components/icon-selector.md", "specs/task-plans/index.md", "specs/family/index.md", "specs/date-strategy/index.md", "specs/image/index.md", "specs/medal/index.md", "specs/wishlist/index.md"]
session_topic: '完善 Family Reward 产品文档的逻辑和细节'
session_goals: '完善产品的整体逻辑流程，在现有基础上适度丰富产品想法，将模糊的描述具体化，识别并补充遗漏的功能点，确保从用户场景到功能实现形成完整的逻辑闭环'
selected_approach: 'user-selected'
techniques_used: ['Mind Mapping']
ideas_generated: 150
context_file: 'specs/'
session_active: false
workflow_completed: true

# Brainstorming Session Results

**Facilitator:** boss
**Date:** 2026-02-10

## Session Overview

**Topic:** 完善 Family Reward 产品文档的逻辑和细节

**Goals:** 完善产品的整体逻辑流程，在现有基础上适度丰富产品想法，将模糊的描述具体化，识别并补充遗漏的功能点，确保从用户场景到功能实现形成完整的逻辑闭环

### Context Guidance

**项目背景：** Family Reward 是一款面向儿童的家庭行为管理游戏平台，通过量化日常行为、游戏化积分系统、愿望兑换（物品+互动体验），帮助家长从"情绪控制"走向"规则共治"，为孩子创造透明、公平、安全的成长环境。

**核心机制：**
1. 任务计划系统：家长设置计划任务（循环规则、日期规则、积分值），系统自动生成任务
2. 积分结算系统：好任务完成获得积分，坏任务完成扣除积分；家长可设置奖惩比例
3. Combo激励系统：线性combo（连续完成X次触发）、阶梯combo（每Y次奖励递增）
4. 愿望兑换系统：孩子/家长创建愿望（物品+互动体验），进度条显示，家长确认兑换
5. 辅助游戏化：签到、徽章（铜银金等级）、等级系统、道具卡（9种）、积分银行

**关键用户画像：**
- 家长：全职妈妈/单亲家庭，承担儿童教育主要责任
- 儿童：大孩子（9岁，可独立操作）、小孩子（5岁，需家长协助）
- 管理员：系统管理员角色

**技术架构：**
- 前端：PWA Web App（主端）+ Mini-program（辅助端）
- 后端：Next.js 16 + better-auth + 手机号认证 + rate limit
- 数据库：SQLite（bun:sqlite）+ Drizzle + Redis缓存
- 状态管理：Zustand

### Session Setup

本次头脑风暴将通过系统性的创意技术，从以下维度深入分析：
- **逻辑完整性检查**：识别文档中描述模糊或逻辑不完整的功能模块
- **场景细化**：将高层用户场景转化为具体、可执行的交互流程
- **遗漏补充**：识别文档中未涵盖但必要的功能点或异常处理
- **创意丰富**：在保持产品边界的前提下，适度扩展创新点

**方法论：** 使用结构化的创意技巧，确保不仅发现问题，更能提出可落地的解决方案

## Technique Selection

**Approach:** User-Selected Techniques
**Selected Technique:**

- **Mind Mapping (思维导图)**: 从中心概念视觉化分支想法，发现连接并扩展思维。非常适合梳理产品架构，发现功能模块之间的关联和逻辑缺口，确保从用户场景到功能实现形成完整的逻辑闭环。

**Selection Rationale:** 用户选择了思维导图技巧，这最适合完成以下目标：
1. 将 Family Reward 的复杂产品架构可视化，发现模块间的关联
2. 识别逻辑缺口和遗漏的功能点
3. 从中心主题扩展，确保所有维度都被覆盖
4. 帮助形成完整的逻辑闭环
## Idea Organization and Prioritization

### Thematic Organization

基于思维导图技巧生成的150+个逻辑规则和架构决策，被系统性地组织为以下7大主题：

**主题 1：用户角色与权限体系**
- 家庭注册双流程（管理员开通/家长自主注册）
- 用户角色定义（Admin、Parent主要/次要、Child）
- 家庭成员添加流程（手机号邀请）
- 权限边界（家长完全控制、管理员只观察）
- 产品边界（家庭内部事情不处理）

**主题 2：任务与积分管理系统**
- 任务计划创建、生成（立即生成所有）、暂停/删除
- 任务状态流转（待完成→进行中→已完成/失败）
- 任务重新激活策略（任务数不变/删除未完成任务）
- 积分规则（好行为/坏行为、完成得分/未完成扣分）
- 家庭全局奖惩比例 + 任务级别手动修改
- 积分结算时机（必须审批后才给分）
- 积分变动原则（线性叠加、不回退、可为负数）

**主题 3：游戏化激励体系**
- 徽章系统（5大维度、自动判定、永久记录、等级升级）
- Combo激励（线性/阶梯、宽限机制3种方式、道具卡使用）
- 道具卡系统（4种类型、获得方式、全局CD、数量限制、过期时间）
- 等级系统（基于积分累计最高值、指数递增算法、不会降级）
- 签到系统（独立按钮、弹窗显示任务完成combo、名人名言）
- 积分银行（活期/定期、存款利息、借贷机制、信贷额度）

**主题 4：愿望兑换与家庭管理**
- 愿望创建与审核（家长必须审核、修改后通知儿童）
- 愿望兑换流程（积分够即可兑换、强通知家长、立即扣除积分、愿望移动到已兑换）
- 信贷额度机制（可借贷兑换、不足时显示借贷选项）
- 家庭设置（人员上限、全局奖惩比例、默认任务重新激活策略、道具卡数量限制、道具卡过期时间、家庭角色）

**主题 5：技术架构与数据模型**
- 前端双端架构（PWA管理员+儿童、小程序家长、功能一致、实时推送演进路径）
- 数据库表结构（21个核心表：users、families、task_plans、tasks、wishlists、badges、combo_rules、item_cards等）
- 并发控制（乐观锁 + 轮询同步初期、后期升级WebSocket）
- 缓存策略（前期不做、后期考虑Redis或PostgreSQL缓存）

**主题 6：管理员功能与模板系统**
- 模板管理（5种类型：日期策略、计划任务、徽章、愿望、道具卡、公开/私有标记）
- 图床管理（上传图片、瀑布流展示、引用次数、删除引用数为0的图片）
- 家庭管理（审核注册、暂停/恢复、删除、查看详细信息）
- 日志查看（全局operation_logs、system_logs）
- 通知与沟通（发送通知给家长、家长联系管理员、回复）
- 权限边界（只观察、建议功能、不插手家庭管理）

**主题 7：操作日志与系统完整性**
- 操作日志触发（10大类操作：任务、积分、愿望、道具卡、积分银行、徽章、签到、家庭管理、模板、图床、通知）
- 日志格式（操作者、被操作者、操作类型、积分变动、详情JSON、时间戳）
- 可见性（家长查看自己家庭、儿童查看自己、管理员查看全局）
- 归档策略（数据留存3年、可按年/月分区）

### Cross-Cutting Patterns

**贯穿所有主题的核心原则：**
1. **家长完全控制原则** - 贯穿所有功能模块，确保家长拥有最终决策权
2. **管理员只观察不干预原则** - 管理员功能明确边界，避免过度复杂化
3. **系统边界清晰原则** - 技术解决技术层面、家庭内部问题不介入
4. **线性叠加不回退原则** - 积分变动线性叠加、不回退、可为负数，简化系统复杂度
5. **产品边界务实原则** - 不支持只记录不奖励的任务、不支持孩子间公平性调节、不处理愿望没兑现

### Breakthrough Concepts

**最具创新性的设计突破：**

1. **线性叠加不回退的积分变动规则**
   - 大幅简化系统复杂度，无需实现复杂的rollback逻辑
   - 自然支持积分银行信贷场景（积分可以为负数）
   - 符合"家长完全控制"原则（家长可通过叠加扣分实现任何惩罚）

2. **道具卡自动弹窗询问机制**
   - 任务未完成时，系统判断是否有免combo中断卡，弹窗询问使用
   - 良好的用户体验：道具卡使用前就知道会减少多少积分
   - 与"线性叠加不回退"结合，形成完整的道具卡使用体验

3. **徽章永久记录 + Combo体现坚持**
   - 徽章永久记录（不会因后续行为丢失），代表"曾经达成过这个成就"
   - Combo体现"还在坚持"的状态
   - 合理的设计平衡，避免过度复杂化

### Prioritization Results

基于"可行性和一致性"两个优先级标准，识别出的9个优先级层级：

**优先级 1：数据库表结构定义（21个表）**
- 重要性：所有功能实施的基础
- 可行性：表结构已完整定义，已有部分Drizzle schema，可直接迁移
- 一致性：完全符合技术架构决策（SQLite + Drizzle）

**优先级 2：核心功能逻辑代码化（任务、积分、愿望）**
- 重要性：产品核心引擎，用户最常用功能
- 可行性：所有逻辑规则已完全定义，无模糊描述
- 一致性：符合"线性叠加不回退"和"家长完全控制"原则

**优先级 3：用户角色与权限体系代码化**
- 重要性：产品基础架构，决定所有功能的安全性和可访问性
- 可行性：家庭注册流程已完全定义，实施难度低
- 一致性：符合"家长完全控制"和"管理员只观察"价值观

**优先级 4：操作日志与系统日志实现**
- 重要性：符合数据留存3年的合规要求，提供操作追溯能力
- 可行性：触发条件已完全定义，日志格式已明确
- 一致性：符合合规要求，但日志量大时可能影响性能

**优先级 5：基础通知系统实现（强通知：愿望兑换）**
- 重要性：保证家长的知情权，符合"强通知家长兑换"决策
- 可行性：只需要实现一个通知类型，强通知=弹窗，实现简单
- 一致性：符合"家长控制"原则，但完整通知系统可能后续再加

**优先级 6：游戏化激励体系实现（徽章、Combo、道具卡）**
- 重要性：产品差异化优势，提供完整激励闭环，提升用户粘性
- 可行性：徽章判定逻辑较复杂，Combo宽限机制需要道具卡系统配合，道具卡自动弹窗需要前端配合
- 一致性：完全符合"徽章永久、combo体现坚持"的设计理念

**优先级 7：积分银行实现（活期/定期、利息、借贷）**
- 重要性：给孩子学习财务管理的机会，支持信贷兑换场景，完善积分体系
- 可行性：利息计算逻辑、到期处理、借贷额度判断，中等难度
- 一致性：完全符合"积分可以为负数"和"家长设置信贷额度"的控制机制

**优先级 8：并发控制与实时推送**
- 重要性：支持多设备并发使用，提升用户体验，保证数据一致性
- 可行性：乐观锁需要所有关键表的version字段，轮询同步需要前端定时请求实现，WebSocket/SSE推送需要额外服务器架构
- 一致性：完全符合"初期简单、后期升级"的技术演进策略

**优先级 9：管理员后台完整实现**
- 重要性：支持模板管理和家庭审核，提供管理员观察和建议能力，支持图床管理
- 可行性：图床瀑布流UI需要前端复杂实现，模板管理需要与家长端共享数据，全局日志查看需要分页筛选导出等复杂功能
- 一致性：完全符合"管理员只观察不干预"的权限边界

### Action Planning

#### 立即行动（第1周）

**行动 1：数据库表结构定义**
- 完成所有21个表的完整Drizzle schema定义
- 创建migration脚本
- 在本地环境执行创建表
- 所需资源：开发环境配置完成，Drizzle ORM文档参考，约4-8小时开发时间

**行动 2：用户角色与权限体系代码化**
- 实现家庭注册API（管理员开通、家长自主注册2种方式）
- 配置better-auth认证（手机号+OTP）
- 创建鉴权中间件（role-based access control）
- 实现家庭审核API（管理员批准/驳回）
- 所需资源：better-auth文档参考，认证逻辑开发，约8-12小时开发时间

**行动 3：核心功能逻辑代码化（任务管理）**
- 创建lib/db/queries.ts封装所有数据库查询
- 实现任务管理API（创建、生成、完成、驳回、暂停、删除）
- 测试任务状态流转
- 所需资源：后端开发人员，API路由设计（Next.js API routes），约16-24小时开发时间

#### 短期行动（第2-3周）

**行动 4：核心功能逻辑代码化（积分和愿望）**
- 实现积分结算逻辑（审批后结算、线性叠加）
- 实现愿望管理API（创建、审核、兑换）
- 测试积分变动和愿望兑换流程
- 所需资源：后端开发人员，约12-16小时开发时间

**行动 5：基础通知系统实现**
- 创建notifications表
- 实现愿望兑换时发送强通知
- 实现小程序弹窗通知展示
- 实现通知已读标记
- 所需资源：约6-8小时开发时间，小程序弹窗通知API调研

**行动 6：操作日志与系统日志实现**
- 创建operation_logs和system_logs表
- 在关键操作点插入日志记录代码
- 实现日志查询API（分权限）
- 所需资源：约4-6小时开发时间，日志归档策略设计

#### 中期行动（第4-6周）

**行动 7：游戏化激励体系实现**
- 实现徽章定义和管理API
- 实现徽章判定逻辑（任务完成时检查）
- 实现Combo规则配置和计算
- 实现道具卡定义、获得、使用、过期逻辑
- 前端实现道具卡自动弹窗询问UI
- 所需资源：后端开发人员+前端开发人员（道具卡弹窗UI），约24-32小时开发时间

**行动 8：积分银行实现**
- 创建bank_accounts和bank_transactions表
- 实现存入、取出API
- 实现到期自动计算利息（定时任务）
- 实现信贷额度检查逻辑
- 所需资源：定时任务框架（cron job），利息计算逻辑，约12-16小时开发时间

#### 长期规划（第7-12周）

**行动 9：并发控制与实时推送**
- 实现乐观锁并发控制（关键表添加version字段）
- 实现轮询同步（每30秒）
- 评估并实现SSE或WebSocket推送
- 所需资源：前端轮询逻辑开发，后端乐观锁实现，WebSocket/SSE技术调研，约16-24小时开发时间（分散到多个阶段）

**行动 10：管理员后台完整实现**
- 实现图床上传和瀑布流展示
- 实现模板管理完整功能（5种类型、公开/私有标记）
- 实现全局日志查看和筛选
- 实现管理员通知发送功能
- 所需资源：管理员后台UI开发，图床功能实现，约24-32小时开发时间

## Session Summary and Insights

### Key Achievements

**主要成就：**
- 通过思维导图技巧系统性地梳理了 Family Reward 产品的完整架构
- 生成了150+个逻辑规则和架构决策，覆盖产品文档的所有方面
- 识别并补充了文档中遗漏的关键功能点（操作日志、通知系统、家庭设置、管理员功能）
- 将模糊的描述具体化为可执行的业务逻辑和技术方案
- 形成了完整的逻辑闭环，从用户场景到功能实现都有清晰定义

**创意突破和洞察：**
- **线性叠加不回退的积分变动规则**：大幅简化系统复杂度，自然支持积分银行信贷场景
- **道具卡自动弹窗询问机制**：良好的用户体验，道具卡使用前就知道积分变动
- **徽章永久记录 + Combo体现坚持**：合理的设计平衡，避免过度复杂化
- **家长完全控制 + 管理员只观察**：形成了明确的产品价值观和边界
- **初期简单、后期升级的技术演进策略**：务实的技术选型，支持5000 DAU并发量

**可落地的成果：**
- 21个数据库表的完整结构定义
- 9个优先级的清晰行动计划（立即/短-中/长期）
- 每个行动步骤都有明确的资源需求和开发时间估算
- 完整的操作日志触发条件和格式定义
- 完整的通知系统分类和展示方式设计

### Session Reflections

**什么做得好：**
- 思维导图技巧非常适合梳理复杂产品架构，能够发现模块间的关联和逻辑缺口
- 深入探索每个分支时，用户能够快速给出明确的决策，保持创意流畅性
- 用户对产品边界的理解非常清晰（家长完全控制、管理员只观察、家庭内部事情不处理），这保证了所有逻辑的一致性
- 用户对"可行性和一致性"的优先级标准选择非常务实，确保了所有想法都能落地实施

**关键学习：**
- 产品的逻辑闭环需要从多个维度全面梳理：用户角色、核心功能、游戏化、技术架构、管理功能、操作日志、系统完整性
- 明确的产品边界原则（如家长完全控制、系统边界清晰）是避免过度复杂化的关键
- "线性叠加不回退"这类设计决策能够大幅简化系统复杂度，需要在架构设计时优先考虑
- 技术架构需要支持演进（如轮询→SSE→WebSocket），初期简单、后期升级是务实的选择

**可以改进的地方：**
- 可以考虑使用更多头脑风暴技巧（如六顶思考帽、SCAMPER）从不同角度挖掘更多创新点
- 可以探索更多"适度丰富产品想法"的创意，而不只是完善逻辑闭环
- 可以深入探索一些特定模块的UI交互设计（如通知中心、图床瀑布流）

### Final Notes

本次头脑风暴会话完全达成了用户的目标："完善产品的整体逻辑流程，在现有基础上适度丰富产品想法，将模糊的描述具体化，识别并补充遗漏的功能点，确保从用户场景到功能实现形成完整的逻辑闭环"。

所有150+个逻辑规则和架构决策都已经形成完整的定义，可以直接用于开发规范和实施。9个优先级的清晰行动计划为后续开发提供了明确的路线图。

**文档输出位置：** `_bmad-output/brainstorming/brainstorming-session-2026-02-10.md`

**下一步建议：**
1. 按照立即行动（第1周）开始实施
2. 完成数据库表结构定义后，创建技术规范文档（TECH_SPEC完整版）
3. 定期回顾本次会话的决策，确保开发实施时的一致性
4. 在实施过程中遇到模糊逻辑时，参考本次会话的详细记录
