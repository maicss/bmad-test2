---
stepsCompleted: [1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14]
inputDocuments:
  - _bmad-output/planning-artifacts/prd.md
  - _bmad-output/planning-artifacts/product-brief-bmad-test2-2026-02-11.md
  - _bmad-output/planning-artifacts/prd-validation-report.md
  - docs/TECH_SPEC.md
  - docs/TECH_SPEC_ARCHITECTURE.md
  - docs/TECH_SPEC_DATABASE.md
  - docs/TECH_SPEC_BUN.md
  - docs/TECH_SPEC_TYPES.md
  - docs/TECH_SPEC_API.md
  - docs/TECH_SPEC_PWA.md
  - docs/TECH_SPEC_BDD.md
  - docs/TECH_SPEC_LOGGING.md
  - docs/TECH_SPEC_PERFORMANCE.md
  - docs/TECH_SPEC_TESTING.md
  - _bmad-output/project-context.md
workflowStatus: completed
date: '2026-02-11'
author: boss
projectName: bmad-test2
---

# UX Design Specification - bmad-test2

**Author:** boss
**Date:** 2026-02-11

---

## Executive Summary

### Project Vision

Family Reward 是一款面向家庭的儿童行为管理与愿望兑换平台，通过数字化、量化、游戏化的方式，替代传统的纸质记录（心记、笔记本、徽章墙），为家长和孩子创造有规律、有组织的使用体验。

**核心价值：**
- 从"情绪化控制"走向"规则化共治"
- 消除纸质记录的物理局限（维护不及时、忘记、徽章脱落、孩子作弊）
- 通过自动化任务生成和实时进度可视化，建立可预期的成长环境

### Target Users

#### 1. 职场家长（主要操作者）
- **年龄：** 30-45岁
- **设备：** 主要使用小程序（工作间隙快速访问）
- **使用时段：**
  - 早上（7:00-8:00）：口头激励孩子当日任务
  - 晚上（20:00-22:00）：集中处理审批、设置、数据分析
- **核心需求：**
  - 有规律、有组织的计划任务系统
  - 自动生成每日任务（减少手动操作）
  - 儿童端清晰可见（任务、积分、愿望进度）
  - 批量操作高效处理（15-30分钟集中使用）

#### 2. 儿童（任务执行者）
- **年龄：** 6-12岁
- **设备：** 主要使用平板（大屏游戏化体验）
- **使用时段：** 放学后主动使用（15:30-17:00）
- **核心需求：**
  - 清晰的任务列表和完成状态
  - 即时反馈和游戏化激励（徽章、Combo、等级）
  - 愿望管理（创建、查看进度、兑换）
  - 参与感和积极性（录入愿望、设定目标）

#### 3. 次要家长（辅助操作者）
- **设备：** 小程序或PWA（与主要家长共享设备或独立设备）
- **使用场景：** 主要家长出差或加班时，代为审批孩子任务
- **核心需求：** 了解当前家庭规则，简单快速确认操作

#### 4. 管理员（系统管理员）
- **设备：** 平板 + 小程序 + PC（多设备管理）
- **职责：** 模板管理、家庭审核、图床管理、全局统计
- **核心需求：** 高效批量管理，数据权限控制

**管理员模板使用逻辑（关键）：**
- ✅ 管理员创建的是"公共模板库"
- ✅ 家长"不能直接使用"管理员模板，必须复制为自己的才能使用
- ✅ 家庭任务计划通过 `template_id` 外键引用管理员模板
- ✅ 删除/新增管理员模板"不会影响"任何已引用的家庭任务计划
- ✅ 只有引用计数为 0 的管理员模板才能完全删除，否则标记为"已下架"

### Key Design Challenges

#### 挑战 1：双端体验差异的设计平衡

**问题：** 孩子端（平板）需要游戏化、视觉化、即时反馈；家长端（小程序）需要效率优先、批量操作、数据分析

**设计决策（Tree of Thoughts 评估）：**
- ✅ 采用混合方法：共享核心逻辑 + 响应式断点适配 + 情境化界面

**具体方案：**
- 共享核心布局逻辑和数据流
- 响应式断点：平板（横向布局）vs 小程序（竖屏优化）
- 情境化界面：儿童登录 → 游戏模式；家长登录 → 管理模式
- 优点：平衡开发效率和体验优化
- 缺点：逻辑复杂度中等

#### 挑战 2：非对称使用频率的界面适配

**问题：** 孩子每天多次短时使用，家长每天一次集中使用（15-30分钟）

**设计决策：**
- ✅ 孩子端："即开即用"的快速反馈模式
- ✅ 家长端："高效批量"的处理流程

**具体方案：**
- 孩子端：大按钮、即时状态更新、无需深层导航
- 家长端：批量操作（滑动选择、长按全选）、任务完成趋势预览
- 复杂交互：在小屏设备上使用抽屉式面板、底部操作栏

#### 挑战 3：实时数据同步与离线体验

**问题：** 实时数据同步延迟 < 3秒，同时支持离线操作队列

**设计决策：**
- ✅ 待审批状态：孩子标记完成后显示"待家长确认"状态，不立即增加积分
- ✅ 离线队列：IndexedDB 存储，Background Sync API 上线同步
- ✅ 冲突处理：时间戳优先 + 用户确认提示
- ✅ 网络状态提示：顶部栏显示连接状态（绿色/橙色/红色）

#### 挑战 4：首次使用引导流程

**问题：** 家长需要先创建儿童身份、设置任务类型、查看徽章建议，再参考管理员模板创建任务，理解"计划任务生成规则"

**设计决策：**
- ✅ 采用必需 + 可选的混合引导流程（5步流程可接受）

**具体方案：**

**必需流程（强制完成）：**
1. 创建儿童身份（基本资料 + 头像）
2. 使用管理员创建的模板一键复制试试看（推荐模板 + 快速预览）
3. 设置任务类型（从管理员建议中选择）
4. 查看徽章建议（系统预设徽章）
5. 理解基础规则（交互式演示：循环规则如何生成任务）

**可选流程（可稍后进入）：**
- 自定义任务类型深度调整
- 徽章自定义和修改
- 高级规则配置（排除日期、特殊奖励等）

**优势：**
- 第2步提供"一键复制试试看"，快速获得价值
- 5步流程保证完整引导，用户不会遗漏
- 清晰标记"必需" vs "可选"图标

#### 挑战 5：游戏化激励与教育意义的平衡

**问题：** 如何通过游戏化元素（徽章、Combo、等级）激励孩子，同时不偏离"行为管理"的教育目标？

**设计决策：**
- ✅ 采用游戏化元素 + 内在价值强化

**具体方案：**

**每个游戏化元素关联行为和努力：**
- **徽章：** 附带"为什么获得"说明（"连续7天刷牙 - 证明你有坚持的力量"）
- **Combo中断：** 强调"下一次重新开始就是新机会"（"Combo中断没关系，今天就是新的开始"）
- **进度条：** 显示"距离愿望还差X天（基于当前速度）"（"按照你的速度，5天后就能兑换乐高了"）
- **等级：** 关联到责任感和成长（"你现在是'小助手'等级，因为连续3周完成任务"）

**优势：**
- 高儿童参与度
- 游戏化服务于教育价值
- 强化努力和进步的意义

### Design Opportunities

#### 机会 1："有规律、有组织"的自动化体验

**创新点：** 自动生成每日任务，消除家长每天手动创建的负担

**具体机会：**
- 任务计划的可视化预览（未来7天/30天的任务分布日历视图）
- 管理员模板一键复制试试看：第2步提供快速预览，家长可以一键复制模板立即开始
- 智能任务建议（基于管理员模板 + 家庭自定义历史）
- 规则解释的交互式演示（用动画展示循环规则如何生成任务）

**差异化：** 不同于纸质记录的随意性，强调规律性和可预期性

#### 机会 2：可视化进度驱动的目标感

**创新点：** 进度条实时显示，孩子清楚知道距离愿望还有多远

**具体机会：**
- 状态反馈：孩子标记任务完成，显示"待家长确认"状态
- Combo中断前的"倒计时"提醒（增加紧迫感和游戏感）
- 徽章获得的庆祝动画（增强成就感）
- 每个游戏化元素都关联到"为什么获得"的教育说明

**差异化：** 消除"纸质徽章脱落""孩子作弊"的问题，数字记录永久保存

#### 机会 3：家长效率优化的批量操作（小程序端）

**创新点：** 家长每天只有15-30分钟集中处理时间，主要用小程序

**具体机会：**
- 一键批量同意/驳回（滑动选择、长按全选）
- 任务完成趋势预览（当天/本周/本月对比）
- 签到自动批：每日签到自动获得积分（无需家长审批）

**差异化：** 大幅减少家长操作负担，从"情绪化管理"转向"规则化管理"

#### 机会 4：首次使用引导的渐进式学习

**创新点：** 让家长快速掌握系统的核心逻辑

**具体机会：**

**必需流程（5步）：**
1. **创建儿童身份：** 向导式添加基本信息
2. **管理员模板一键复制试试看：** 推荐模板展示 + 快速预览 + 一键复制
3. **设置任务类型：** 从管理员建议中选择基础类型
4. **查看徽章建议：** 浏览系统预设徽章
5. **理解基础规则：** 交互式演示循环规则如何工作

**可选流程（可稍后）：**
- 任务类型深度自定义
- 徽章修改和创建
- 高级规则配置

**优势：**
- 5步保证完整引导，用户不会遗漏关键功能
- 第2步提供"一键复制试试看"，快速获得价值体验
- 后续步骤可跳过，降低首次使用负担

---

## Pre-mortem Analysis - 失败场景预防

### 关键失败场景及预防措施

| 失败场景 | 根本原因 | 关键预防措施 |
|---------|----------|-------------|
| **首次引导失败** | 流程过长、不够吸引、缺少即时价值 | 强化第 2 步价值感知、快速开始模式、循环规则交互式解释 |
| **儿童不喜欢使用** | 界面不够游戏化、反馈不即时、任务难度不合理 | 强化游戏化元素、首次使用引导儿童、任务难度合理化调整 |
| **家长不使用** | 批量操作不够高效、孩子任务标记不及时、缺乏价值感知 | 优化批量操作效率、延迟审批友好设计、价值感知强化 |
| **双端体验不一致** | 同步延迟、冲突、状态显示不一致 | 强化实时同步体验、状态表示一致性 |
| **游戏化失去激励** | 徽章与行为脱节、Combo 压力、等级无意义 | 徽章与行为价值关联、Combo 中断正向重构 |
| **管理员模板发布混乱** | 没有预览、发布影响范围大 | 模板预览 + 引用关系设计（简化两步流程） |

### 预防措施详细设计

#### 措施 1：首次使用引导优化

**优化：** "管理员模板一键复制试试看" → "一键复制 + 即时预览"

**具体设计：**
- 管理员模板列表展示：
  - 大预览卡片（显示任务分布、积分奖励、徽章关联）
  - 点击预览 → 弹出完整任务日历视图（未来 7 天/30 天）
  - "复制"按钮大且突出，文案："立即使用此模板，5 分钟内开始"
- 复制成功后：
  - 显示庆祝动画（简单烟花效果）
  - 自动跳转到"儿童已创建"提示（第 3 步）
  - 文案："太棒了！您的任务计划已创建，现在添加孩子吧"

#### 措施 2：强化游戏化元素（孩子端）

**优化：** 平板端设计为"游戏化界面"

**具体设计：**
- **大按钮 + 鲜艳色彩：**
  - 按钮尺寸 ≥ 80x80pt，方便点击
  - 使用儿童友好的配色（蓝色、绿色、黄色）
- **音效反馈：**
  - 完成任务：叮~！
  - 获得徽章：掌声 + 彩虹动画
  - Combo 中断：遗憾的音效 + "没关系，重新开始"提示
- **动画过渡：**
  - 页面切换：滑入/滑出动画
  - 进度条更新：数字滚动动画（85 → 86）
  - 徽章获得：从屏幕中心弹出的庆祝动画
- **表情/角色：**
  - 任务完成后显示"小助手"表情说"太棒了！"
  - Combo 达到显示"火焰"表情鼓励坚持

#### 措施 3：优化家长端批量操作效率

**具体设计：**
- **滑动多选 + 长按全选：**
  - 任务列表支持滑动多选（类似微信聊天长按）
  - 长按任意任务 → 全选当天任务
  - 底部固定操作栏："全部同意"、"全部驳回"
- **智能分组：**
  - 按状态分组：待审批（10）、已完成（5）
  - 按任务类型分组：日常（6）、学习（4）
  - 点击分组标题 → 全选该组所有任务
- **批量操作确认：**
  - 点击"全部同意" → 弹出确认："确认批准 10 个任务？+积分：+50 分"
  - 点击确认 → 立即执行，无需二次确认
- **历史行为对比：**
  - 显示"本周 vs 上周"任务完成率对比
  - 高亮"异常"任务（如"今天快速完成了 5 个任务"）

#### 措施 4：强化实时同步体验

**具体设计：**
- **实时同步指示器：**
  - 孩子端：顶部栏显示"正在同步..."旋转图标
  - 同步完成：播放"叮~"音效，图标变绿色对勾
  - 同步失败：红色图标 + "点击重试"按钮
- **乐观 UI 更新：**
  - 家长审批后，孩子端立即显示积分增加
  - 标注："积分已更新（确认时间：2 秒前）"
  - 背景静默同步数据
- **冲突处理：**
  - 如果孩子离线操作和家长审批冲突：
    - 显示提示："您离线操作与家长审批冲突"
    - 提供"保留离线版本"或"使用家长版本"选择
- **强制刷新按钮：**
  - 下拉刷新手势，立即同步最新数据
  - 文案："下拉更新最新数据"

#### 措施 5：徽章与行为价值关联（已在决策 3 中设计）

**具体设计（强化版）：**
- **徽章详情弹窗：**
  - 徽章大图 + "为什么获得"说明
  - 例："连续 7 天刷牙 - 证明你有坚持的力量！"
  - 显示："累计 7 天，完成 7 个任务"
  - 表情："小助手"说："王浩太棒了！"
- **徽章墙展示：**
  - 按获得时间排序，最近获得的徽章在最前
  - 悬停徽章 → 显示完整说明
  - 点击徽章 → 可以分享到家长微信："看我获得的徽章！"

#### 措施 6：管理员模板发布流程（简化版）

**优化：** 两步流程（草稿 → 发布）+ 引用关系设计

**具体设计：**

**步骤 1：草稿**
- 管理员创建或编辑模板，保存为"草稿"状态
- 仅管理员可见，家长无法选择或复制
- 可以随时编辑和删除

**步骤 2：发布**
- 一键发布模板，对所有家长可见
- 确认提示："发布后，家长可以浏览并复制此模板"
- 发布后进入"已发布"状态

**引用关系设计（关键）：**
```
家庭任务计划 (task_plans)
├─ template_id → 外键引用管理员模板
└─ family_id → 所属家庭

管理员模板 (admin_templates - 假设表名)
├─ is_published → 是否发布（草稿/已发布）
├─ reference_count → 引用计数（多少家庭复制了此模板）
└─ created_at, updated_at

删除逻辑：
- 删除管理员模板时：
  → 如果 reference_count > 0：
      - 标记为"已下架"（is_published = false）
      - 已引用的家庭任务计划不受影响
  → 如果 reference_count = 0：
      - 允许完全删除
```

**设计优势：**
- ✅ 流程简化，减少管理员负担
- ✅ 发布后家长才能复制，降低误发布风险
- ✅ 删除不影响已引用的家庭任务计划
- ✅ 提供引用计数，了解模板受欢迎程度
- ✅ 符合"家长不能直接使用，必须复制"的逻辑
- ✅ 降低批量失败风险（仅影响新复制的家长）

---

## 次要家长 vs 主要家长的区别

**角色区别：**

| 权限 | 主要家长 | 次要家长 |
|------|----------|----------|
| **管理家庭成员** | ✅ 可以 | ❌ 不能 |
| 创建任务计划 | ✅ | ✅ |
| 批准/驳回任务 | ✅ | ✅ |
| 临时加减分 | ✅ | ✅ |
| 查看数据统计 | ✅ | ✅ |
| 家庭设置 | ✅ | ✅ |

**设计考虑：**
- 次要家长登录后，隐藏"家庭成员管理"入口
- 其他功能与主要家长完全一致，降低学习成本

---

## Design System Foundation

### 1.1 Design System Choice

**选择：基于现有技术栈的设计系统 - Tailwind CSS + Shadcn UI**

### Rationale for Selection

1. **符合技术栈** - project-context.md 已明确指定 Tailwind CSS 4 + Shadcn UI 3.7.0+
2. **开发速度快** - 成熟组件库、开箱即用、快速原型
3. **维护成本低** - 社区支持、自动更新、长期稳定性
4. **学习曲线平缓** - 团队熟悉 React 生态，降低学习成本
5. **组件丰富** - Shadcn 提供丰富的 UI 组件（按钮、表单、对话框、提示等）
6. **响应式设计** - 内置响应式系统，适配平板、小程序、PC 三端
7. **定制灵活性** - Tailwind 允许样式自定义，同时使用 Shadcn 组件

### Implementation Approach

#### 1. Shadcn UI 组件库使用

**核心组件：**
- ✅ 按钮 - 多种变体（主要、次要、幽灵、危险等）
- ✅ 表单 - 输入框、下拉框、复选框、单选框
- ✅ 对话框 - 确认提示、表单对话框、警示对话框
- ✅ 提示 - 顶部/底部通知、操作确认
- ✅ 数据展示 - 表格、卡片、列表、进度条

**使用策略：**
- 优先使用 Shadcn 组件，确保一致性
- 自定义时通过 Tailwind 类名覆盖样式
- 复杂交互使用 Shadcn 的可组合组件

#### 2. 定制化设计系统

**Tailwind CSS 配置：**
- 定义设计令牌（Design Tokens）：颜色、间距、字体大小
- 主题切换支持（浅色/深色模式）
- 统一的间距系统（4px、8px、16px、24px 等）

**Shadcn 自定义：**
- 通过 tailwind.config.ts 扩展默认主题
- 自定义组件样式（如游戏化元素的特殊样式）
- 添加自定义组件（如徽章墙、Combo 火焰特效）

#### 3. 设计令牌

**颜色系统：**
- 主色调：蓝色系（儿童友好）
- 成功色：绿色（积分增加、任务完成）
- 警告色：橙色（待审批、同步中）
- 错误色：红色（同步失败、操作失败）
- 中性色：灰色（禁用、已归档）

**间距系统：**
- 间距单位：4px 基础单位
- 规则：4、8、16、24、32、48px
- 用途：内边距、外边距、间距、间隙

**字体系统：**
- 字号层级：h1-6xl (48px) → h6-base (16px)
- 字重：300 (light) → 700 (bold)
- 行高：1.5（正文）、1.25（标题）

### Customization Strategy

#### 游戏化元素定制

**自定义需求：**
- 徽章墙组件（Shadcn 没有提供）
- Combo 火焰特效（动画组件）
- 庆祝动画（烟花、彩虹效果）
- 音效反馈（Playwright 音效测试）

**实现方式：**
- 基于 Shadcn 组件构建自定义组件
- 使用 Tailwind 动画（@keyframes）
- 使用 Framer Motion（如果需要复杂动画）

#### 响应式断点

**设备适配：**
```typescript
// tailwind.config.ts
export default {
  theme: {
    screens: {
      // 平板（儿童端）
      'tablet': '768px',
      // 小程序（家长端）
      'mini-program': '450px',
      // PC（管理员）
      'desktop': '1024px',
    },
  },
}
```

**应用场景：**
- 儿童端：优先平板横向布局（768px+）
- 家长端：优先小程序竖屏布局（< 450px）
- 管理员端：PC 桌面布局（1024px+）
- 响应式设计：使用 Flexbox/Grid 自适应不同屏幕

---

## Design Directions

基于前面的分析（项目理解、核心体验、情感响应、灵感分析、设计系统、视觉基础），以下是 Family Reward 的推荐设计方向：

### 设计方向 A：温和友好型（儿童优先）

**重点：** 游戏化、大卡片、丰富动画
- 布局：宽松间距、大按钮（80x80pt+）
- 视觉重量：中等（不拥挤）
- 适合：儿童端平板体验

**关键特征：**
- 大尺寸卡片展示任务、积分、愿望
- 丰富的庆祝动画（徽章获得、Combo 达到、愿望兑换）
- 鲜艳的色彩系统（蓝色 + 黄色主色调）
- 大按钮和触摸目标区域

---

### 设计方向 B：专业效率型（家长优先）

**重点：** 清晰列表、批量操作、数据可视化
- 布局：紧凑但清晰、信息密集
- 视觉重量：轻盈（快速浏览）
- 适合：家长端小程序体验

**关键特征：**
- 任务列表：清晰的状态标识（待审批、已批准、已驳回）
- 批量操作：滑动多选、长按全选、一键同意/驳回
- 数据仪表盘：趋势图表、完成率对比、异常任务高亮
- 紧凑的导航：快速切换不同功能模块

---

### 设计方向 C：平衡双端型

**重点：** 统一设计语言、响应式适配
- 布局：平板横向布局、小程序竖屏布局
- 视觉重量：中等（平衡游戏感和专业性）
- 适合：整体体验一致性

**关键特征：**
- 统一的状态定义（双端一致）
- 响应式断点（tablet: 768px, mini-program: 450px, desktop: 1024px）
- 共享的组件库（Shadcn UI + Tailwind CSS）
- 一致的颜色系统和图标系统

---

## 推荐选择

基于 Family Reward 的特点，我推荐：**设计方向 C - 平衡双端型**

**理由：**
1. ✅ 平衡儿童端（游戏化）和家长端（效率）的不同需求
2. ✅ 统一的设计语言确保跨端一致性
3. ✅ 响应式设计适配不同设备（平板、小程序、PC）
4. ✅ 符合已选择的设计系统（Tailwind + Shadcn UI）
5. ✅ 降低长期维护成本（统一组件、一致交互）

---

---

## User Journey Flows

基于 PRD 中已定义的用户旅程，我设计了 3 个主要旅程 + 1 个补充管理员工作流。

---

### 旅程 1：职场家长日常管理

#### 旅程概述

**用户：** 李妈妈（35岁，双职工家庭的主要育儿负责人）
**目标：** 高效管理孩子的日常行为，改善亲子关系
**关键场景：** 早晨口头激励（7:00-8:00）、晚上集中处理（20:00-22:00）

---

#### Mermaid 流程图

```mermaid
flowchart TD
    Start([登录]) --> CheckDaytime{是早晨还是晚上?}

    CheckDaytime -->|早晨| MorningRoutine[早晨口头激励]
    CheckDaytime -->|晚上| EveningSession[晚上集中处理]

    subgraph MorningRoutine [早晨口头激励]
        MR[查看今日概况<br/>签到情况<br/>待审批任务] 
        MR -->|是| LeaveForSchool[送孩子上学<br/>口头提醒当日任务]

    subgraph EveningSession [晚上集中处理]
        ES1[查看今日概况]
        ES1 -->|是| BatchApprove[批量审批<br/>滑动多选<br/>长按全选]
        ES1 -->|否| ReviewTrends[查看成长曲线<br/>统计数据]
        ReviewTrends -->|是| PlanFuture[规划未来任务<br/>考虑放假安排]
        ReviewTrends -->|否| BrowseTemplates[浏览管理员<br/>新模板]
        ES1 -->|否| End1[结束会话<br/>保存数据]

    LeaveForSchool -->| MR
```

---

#### 流程步骤详解

**步骤 1：登录**
- 输入：手机号 + 密码 / PIN
- 按键："登录"
- 权限识别：主要家长 / 次要家长 / 儿童 / 管理员
- 显示：根据角色显示不同的首页

**步骤 2：查看今日概况**
- 显示内容：
  - 今日签到状态（已签 / 未签）
  - 待审批任务数量
  - 累计积分变化
- 交互：下拉刷新或自动刷新
- 触摸：下拉刷新手势

**步骤 3：早晨口头激励（早晨时段）**
- 场景：送孩子上学路上
- 关键行为：
  - "今天记得刷牙哦，已经连续 5 天了，再坚持 2 天就有 combo 奖励！"
  - "你的乐高愿望还差 30 分，这周努力就能兑换了！"
- 目的：在孩子心中建立预期
- 交互：不打开 app，仅口头提醒

**步骤 4：晚上集中处理**
- 批量审批：
  - 滑动多选：任务列表支持滑动选择
  - 长按全选：长按任意任务 → 全选当天任务
  - 底部固定操作栏："全部同意"、"全部驳回"
- 批量确认：
  - 点击"全部同意" → 弹出确认："确认批准 10 个任务？+ 积分：+50 分"
  - 点击确认 → 立即执行，无需二次确认
- 历史行为对比：
  - 显示"本周 vs 上周"任务完成率对比
  - 高亮"异常"任务（如"今天快速完成了 5 个任务"）

**步骤 5：查看成长曲线和统计数据**
- 数据展示：
  - 本周任务完成率（折线图）
  - 积分趋势（上升 / 下降）
  - Combo 连胜记录
  - 徽章获得历史
- 交互：
  - 点击任务卡片查看详情
  - 切换时间范围（7 天 / 30 天 / 90 天）

**步骤 6：规划未来任务**
- 功能：考虑放假安排
- 操作：添加临时任务或排除日期
- 预览：未来 7 天 / 30 天任务分布日历视图
- 应用：排除特定日期（如周末、假期）

**步骤 7：浏览管理员新模板**
- 模板列表：按年龄分类、按兴趣分类
- 模板预览：点击预览 → 弹出完整任务日历视图（未来 7 天 / 30 天）
- 一键复制：大且突出的"复制"按钮，文案："立即使用此模板，5 分钟内开始"
- 复制成功后：
  - 显示庆祝动画（简单烟花效果）
  - 自动跳转到"儿童已创建"提示（步骤 3）
  - 文案："太棒了！您的任务计划已创建，现在添加孩子吧"

**步骤 8：结束会话**
- 保存数据：所有更改自动保存
- 下次登录：快速恢复上次状态
- 通知："您的数据已保存，下次打开时自动加载"

---

### 旅程 2：孩子主动使用

#### 旅程概述

**用户：** 王浩（9 岁男孩）
**目标：** 通过完成任务获得积分，兑换愿望
**关键场景：** 放学后主动使用（15:30-17:00）

---

#### Mermaid 流程图

```mermaid
flowchart TD
    Start([登录]) --> Checkin[签到]

    Checkin --> SignInSuccess[签到成功<br/>+5 积分]
    SignInSuccess --> ViewDashboard[查看数据<br/>总积分<br/>愿望进度<br/>combo 状态]

    ViewDashboard --> ChooseAction{选择操作}
    ChooseAction -->|标记完成| CompleteTasks[标记任务完成<br/>刷牙、学校表现<br/>帮助同学]
    ChooseAction -->|录入愿望| AddWish[录入愿望<br/>新增想要的奖励]
    ChooseAction -->|查看徽章| ViewBadges[查看徽章墙<br/>是否有新徽章]

    subgraph CompleteTasks [标记任务完成]
        CT[选择任务]
        CT -->|是| MarkComplete[标记完成<br/>显示"待确认"]
        MarkComplete -->|待家长确认| ParentApprove{家长确认<br/>等待李妈妈审批}
        CT --> ViewBadges

    subgraph AddWish [录入愿望]
        AW[输入愿望详情<br/>名称、描述<br/>图片]
        AW -->| SaveWish[保存愿望<br/>添加到愿望列表]
        SaveWish -->|is| ViewDashboard

    subgraph ViewBadges [查看徽章墙]
        VB[按获得时间排序<br/>最新徽章在前]
        VB -->|是| BadgeDetail[徽章详情<br/>大图 + 为什么获得]
        VB -->| BadgeDetail
        BadgeDetail -->|is| ShareBadge[分享<br/>分享到家长微信]
        VB -->| BadgeDetail
        BadgeDetail -->|no| ViewDashboard

    subgraph ParentApprove [家长确认]
        PA{家长收到审批通知]
        PA -->|is| PointsUpdate{积分更新<br/>积分正式增加<br/>播放庆祝动画}
        PA --> PointsUpdate -->|is| ViewDashboard
        PA -->|no|| PointsPending[积分待定<br/>家长未及时审批<br/>显示为"待确认"]
        PA -->|no| ViewDashboard

    PointsPending -->| NotifyParent[提醒家长<br/>发送通知<br/>"请审批我的任务"]
    NotifyParent -->|is| ViewDashboard

    ViewDashboard -->| RedeemWish[兑换愿望]
    RedeemWish -->|is| ConfirmRedeem{确认兑换<br/>扣除积分<br/>显示成功页面}
        ConfirmRedeem -->|no| RedeemSuccess[兑换成功<br/>成功页面<br/>积分扣除动画]
        RedeemSuccess -->|is| ViewDashboard
        RedeemSuccess -->|no| RedeemCancel[取消兑换<br/>返回愿望列表]
        RedeemCancel -->|is| ViewDashboard

    ViewDashboard -->| SignOut[退出登录]
```

---

#### 流程步骤详解

**步骤 1：登录**
- 输入：PIN 码（儿童使用 PIN 登录）
- 按钮：PIN 码键盘 + 登录
- 权限：仅儿童端功能
- 显示：儿童专用首页

**步骤 2：签到**
- 操作：点击"签到"按钮
- 即时反馈：
  - +5 积分显示（绿色对勾）
  - 音效：叮~！
- 显示内容：
  - 今日签到状态（已签 / 未签）
  - 连胜签到计数
- 交互：
  - 签到后立即看到积分增加
  - 无需等待家长审批（签到自动批）

**步骤 3：查看数据**
- 显示内容：
  - 总积分（大数字显示）
  - 愿望进度条：动态计算"还差 X 天"
    - 示例："按照你的速度，5 天后就能兑换乐高了"
  - Combo 状态：连续天数、下级奖励预览
  - 今日任务列表：待完成 / 已完成 / 待确认
- 心理活动：
  - "还差 20 分就能换那个玩具了！"
  - "已经连续 7 天刷牙了，不能中断！"
  - "我要记下想去游乐园的愿望..."

**步骤 4：选择操作**
- 大按钮：
  - 标记任务完成（最常用）
  - 录入愿望
  - 查看徽章
- 布局：大卡片式设计（80x80pt+ 触摸目标）
- 视觉权重：重要操作突出显示

**步骤 5：标记任务完成**
- 选择任务：
  - 早上刷牙
  - 学校表现好
  - 帮助同学
- 操作：点击任务卡片 → 显示"已完成"
- 状态变化：
  - 任务图标变对勾
  - 文案变更为"待家长确认"
  - 积分显示为"待增加"（灰色，带锁图标）
- 心理活动：
  - "我完成刷牙了！"
  - "今天学校表现很好，帮助了同学！"

**步骤 6：录入愿望**
- 操作：点击"+"按钮
- 表单：
  - 愿望名称（输入框）
  - 描述（文本域）
  - 积分要求（数字输入）
  - 图片（上传或选择预设图片）
- 保存：点击"保存"按钮
- 即时反馈：愿望添加到列表

**步骤 7：查看徽章**
- 显示：徽章墙（按获得时间倒序排列）
- 交互：
  - 悬停徽章 → 显示详细信息
  - 点击徽章 → 弹出详情弹窗：
    - 徽章大图
    - "为什么获得"说明："连续 7 天刷牙 - 证明你有坚持的力量！"
    - "累计 7 天，完成 7 个任务"
    - 表情："小助手"说："王浩太棒了！"
- 分享功能：
  - 点击"分享"按钮
  - 分享内容：发送到家长微信："看我获得的徽章！"

**步骤 8：退出登录**
- 操作：点击"退出"
- 确认对话框："确定要退出吗？"
- 保存状态：所有更改自动保存

---

### 旅程 3：次要家长辅助操作

#### 旅程概述

**用户：** 王爸爸（次要家长）
**目标：** 在主要家长忙碌时协助管理孩子任务
**关键场景：** 主要家长出差或加班时，代为审批孩子任务

---

#### Mermaid 流程图

```mermaid
flowchart TD
    Start([登录]) --> CheckNotifications[检查通知]

    CheckNotifications -->|有待审批| ViewPendingTasks[查看待审批任务<br/>孩子标记了3个任务<br/>等待李妈妈审批]
    CheckNotifications -->|无待审批| End2[无任务<br/>查看家庭规则<br/>退出登录]

    subgraph ViewPendingTasks [查看待审批任务]
        VPT[查看任务列表]
        VPT -->|是| ViewDetails[查看任务详情<br/>任务名称<br/>完成时间<br/>描述]
        VPT -->|is| Approve[单个审批<br/>点击"同意"按钮]
        VPT -->|no| ViewDetails

    subgraph Approve [单个审批]
        APR[审批成功<br/>+ 积分确认<br/>显示确认提示]
        APR -->|is| Adjust[临时加减分<br/>± 分<br/>输入备注]
        APR -->|is| Adjust
        Adjust -->|no| ViewDetails

    subgraph ViewDetails [查看任务详情]
        VD[查看任务]
        VD -->|有作弊嫌疑| MarkSuspicious[标记"疑似作弊"<br/>高亮显示]
        VD -->|no| VPT

    subgraph MarkSuspicious [标记疑似作弊]
        MS[添加备注<br/>填写原因<br/>提交]
        MS -->|is| VPT
        MS -->|is| ViewDetails

    subgraph ViewDetails [查看任务]
        VD[已完成| Ignore[忽略<br/>已处理]
        VD -->|no| VPT

    subgraph Approve [单个审批]
        APR2[审批失败<br/>显示错误提示]
        APR2 -->|no| VPT

    subgraph ViewDetails [查看任务]
        VD[查看任务]
        VD -->|is| ViewFamily[查看家庭成员<br/>了解权限<br/>不擅自修改]
        VD -->|is| ViewFamily

    subgraph ViewFamily [查看家庭成员]
        VF[查看家庭列表<br/>家庭成员列表]
        VF -->|是| ViewFamily[查看家庭详情<br/>李妈妈、王浩]
        VF -->|no| ViewFamily
        VF -->|no| ViewFamily

    subgraph ViewFamily [查看家庭列表]
        VF[查看任务]
        VF -->|是| End2[结束会话<br/>退出登录]

    ViewPendingTasks -->| MR
```

---

#### 流程步骤详解

**步骤 1：登录**
- 输入：手机号 + 密码 / PIN
- 按键："登录"
- 权限识别：次要家长
- 显示：
  - 家庭成员列表
  - 权限说明："您有查看和审批权限，无法管理家庭成员"

**步骤 2：检查通知**
- 自动检查：打开应用时自动检查是否有待审批任务
- 通知提示：
  - "王浩有 3 个任务待审批"
  - 橙红色提醒图标
- 交互：
  - 点击通知 → 直接跳转到待审批任务列表

**步骤 3：查看待审批任务（有任务时）**
- 显示：待审批任务列表
- 任务状态：待确认（橙色图标）
- 操作：
  - 单个审批：点击任务卡片
  - 批量审批：
    - 滑动多选任务
    - 长按全选
    - 底部操作栏："全部同意"、"全部驳回"
- 功能说明：
  - "您是次要家长，可以查看任务详情和单个审批，无法批量操作"

**步骤 4：查看任务详情**
- 显示内容：
  - 任务名称：早上刷牙
  - 完成时间：今天 08:30
  - 描述：独立完成，7 天内完成
  - 奖励积分：5 分
- 标记作弊：
  - 点击"标记疑似作弊"
  - 理由输入框（必填）
  - 填写原因："孩子 1 分钟内完成了 3 个任务，不合理"
  - 提交：添加备注并高亮显示

**步骤 5：单个审批/驳回**
- 操作：点击"同意"或"驳回"
- 即时反馈：
  - 同意：任务状态变更为"已批准"（绿色），积分正式增加
  - 驳回：任务状态变更为"已驳回"（红色）
- 确认提示：
  - 同意："确认批准 3 个刷牙任务？+ 积分：+15 分"
  - 驳回："确认驳回吗？任务未正确完成"

**步骤 6：临时加减分**
- 操作：点击"± 分"按钮
- 弹窗：
  - 积分调整：+5 分 / -5 分
  - 备注输入框（必填）
- 确认："确认加减分？+3 分"
- 家长通知：
  - "王爸爸给王浩临时加了 3 分，原因是：表现好"
  - 积分实时更新

**步骤 7：查看家庭规则**
- 目的：了解当前家庭设置，不擅自修改
- 显示内容：
  - 积分规则
  - Combo 规则
  - 愿望兑换规则
- 注意：
  - "您是次要家长，只能查看和审批，无法修改规则"
  - "如需修改规则，请联系李妈妈"

**步骤 8：查看家庭成员**
- 显示内容：
  - 家庭成员列表
  - 角色：主要家长（李妈妈）、次要家长（王爸爸）
  - 关联儿童：王浩
- 权限说明：
  - 主要家长：管理、查看、审批、修改
  - 次要家长：查看、审批（无管理权限）

**步骤 9：退出登录**
- 操作：点击"退出"
- 确认对话框："确定要退出吗？"
- 保存状态

---

### 旅程 4：管理员工作流（补充）

#### 旅程概述

**用户：** 管理员
**目标：** 模板管理、家庭审核、全局监控

---

#### Mermaid 流程图

```mermaid
flowchart TD
    Start([登录]) --> Dashboard[管理员仪表盘]

    Dashboard -->|模板管理| TemplateManagement[创建模板<br/>编辑模板<br/>草稿/发布<br/>删除模板]
    Dashboard -->|家庭审核| FamilyAudit[审核家庭<br/>通过/拒绝<br/>查看详情]
    Dashboard -->|全局监控| GlobalMonitor[全局统计<br/>家庭数量<br/>活跃家庭<br/>任务完成率]
    Dashboard -->|End3[结束会话]

    subgraph TemplateManagement [模板管理]
        TM[选择操作]
        TM -->|创建| CreateTemplate[创建新模板<br/>输入模板信息<br/>任务列表<br/>循环规则<br/>日期策略]
        TM -->|编辑| EditTemplate[编辑已有模板<br/>修改任务<br/>调整规则<br/>关联徽章]
        TM -->|草稿| DraftTemplate[保存为草稿<br/>仅管理员可见]
        TM -->|发布| PublishTemplate[发布模板<br/>对所有家长可见<br/>确认对话框]
        TM -->|删除| DeleteTemplate[删除模板<br/>检查引用计数<br/>引用>0 标记下架]
        TM -->|no| TemplateManagement[返回模板管理]

    subgraph CreateTemplate [创建新模板]
        CT[输入信息]
            CT -->|is| AddTasks[添加任务项<br/>设置积分值<br/>关联徽章]
            CT -->|is| SetRules[设置循环规则<br/>每日/每周<br/>排除日期]
            CT -->|is| LinkBadges[关联徽章<br/>选择徽章<br/>完成任务获得]
            CT -->|is| Preview[预览模板<br/>查看日历视图<br/>未来 7 天]
            CT -->|is| SaveDraft[保存草稿<br/>模板名称<br/>创建时间]
            CT -->|no| TemplateManagement

    subgraph EditTemplate [编辑已有模板]
        ET[编辑模板]
            ET -->|is| AddTasks
            ET -->|is| SetRules
            ET -->|is| LinkBadges
            ET -->|is| Preview
            ET -->|is| SaveDraft

    subgraph PublishTemplate [发布模板]
        PT[确认对话框]
            PT -->|是| TemplateManagement[返回模板管理<br/>所有家长可见]
            PT -->|否| TemplateManagement

    subgraph DeleteTemplate [删除模板]
        DLT[删除对话框]
            DLT -->|is| referenceCount>0| DeleteConfirmed[确认删除<br/>完全删除模板]
            DLT -->|is| referenceCount>0| Unpublish[标记下架<br/>保留数据<br/>对家长隐藏]
            DLT -->|no| TemplateManagement

    subgraph FamilyAudit [家庭审核]
        FA[家庭列表]
        FA -->|审核| ReviewFamily[查看家庭详情<br/>任务完成率<br/>成员数量<br/>注册时间]
        FA -->|通过| ApproveFamily[通过审核<br/>激活家庭]
            FA -->|is| FamilyAudit[返回家庭审核]

    subgraph ApproveFamily [通过审核]
        AF[激活成功]
            AF -->|is| FamilyAudit[返回家庭审核]

    subgraph RejectFamily [拒绝审核]
        RF[拒绝成功]
            RF -->|is| FamilyAudit[返回家庭审核]

    subgraph FamilyAudit [返回家庭审核]
        GM[查看统计数据]
        GM -->|导出| ExportReport[导出报表<br/>CSV 格式<br/>时间范围选择]
        GM -->|is| GlobalMonitor[返回全局监控]

    subgraph ExportReport [导出报表]
        GM -->|结束会话]

    subgraph GlobalMonitor [全局监控]
        GM -->|is| End3

```

---

#### 流程步骤详解

**步骤 1：登录**
- 输入：管理员凭证
- 权限：完整管理员权限
- 显示：管理员专用仪表盘

**步骤 2：管理员仪表盘**
- 显示内容：
  - 模板管理入口
  - 家庭审核入口
  - 全局监控入口
- 布局：大卡片式管理界面

**步骤 3：创建模板**
- 操作：点击"创建新模板"
- 表单输入：
  - 模板名称（必填）
  - 适用年龄段（6-8 岁、9-12 岁）
  - 任务列表（添加多个任务）
  - 每个任务的积分值
  - 循环规则（每日、每周）
  - 日期策略（工作日、排除周末等）
- 保存：点击"保存为草稿"

**步骤 4：编辑模板**
- 操作：点击已有模板
- 功能：修改任务、调整规则、关联徽章
- 实时预览：点击"预览"按钮
- 保存：保存为草稿

**步骤 5：保存为草稿**
- 操作：点击"保存为草稿"
- 状态：
  - 模板保存为"草稿"状态
  - 仅管理员可见
  - 家长无法选择或复制

**步骤 6：发布模板**
- 操作：点击"发布"按钮
- 确认对话框：
  - "发布后，所有家长都能看到此模板"
  - "预计影响约 100 个家庭"
- 发布后：
  - 模板状态变为"已发布"
  - 对所有家长可见

**步骤 7：删除模板**
- 操作：点击"删除"按钮
- 引用计数检查：
  - 如果 reference_count > 0：
    - 提示："已有 25 个家庭复制了此模板，无法完全删除。是否标记为下架？"
    - 选择"下架"：对家长隐藏，保留数据
    - 选择"确认删除"：完全删除（引用计数为 0）
  - 如果 reference_count = 0：
    - 提示："此模板未被任何家庭使用，是否确认删除？"
    - 选择"确认删除"：完全删除模板

**步骤 8：家庭审核**
- 显示：家庭列表
- 过滤选项：全部 / 待审核 / 已通过 / 已拒绝
- 操作：点击家庭查看详情
- 显示内容：
  - 任务完成率图表
  - 成员数量
  - 注册时间
  - 最近活动日志
- 审核：
  - 通过审核：激活家庭，发送通知："您的家庭已通过审核，现在可以使用完整功能"
  - 拒绝审核：删除家庭，冻结数据："您的家庭被拒绝，请联系管理员"
- 批量操作：
  - 批量通过审核：选择多个家庭 → 点击"批量通过"
  - 批量拒绝审核：选择多个家庭 → 点击"批量拒绝"

**步骤 9：全局监控**
- 显示统计数据：
  - 总家庭数量
  - 活跃家庭数量
  - 平均任务完成率
  - 积分分布图
- 导出报表：
  - 选择时间范围：7 天 / 30 天 / 90 天
  - 导出格式：CSV
  - 下载：点击"导出"按钮

**步骤 10：结束会话**
- 操作：点击"退出"
- 确认对话框："确定要退出吗？"
- 保存状态

---

### Journey Patterns（旅程模式）

基于 4 个用户旅程的设计，我提取了以下可复用的模式：

#### 导航模式（Navigation Patterns）

**1. 首页仪表盘模式**
- **应用范围：** 职场家长、次要家长、儿童、管理员
- **模式：** 所有角色登录后首先看到"仪表盘视图"
- **设计原则：**
  - 首屏展示"今日概况"（签到状态、待审批任务、积分变化）
  - 快速访问主要功能入口（任务列表、愿望列表、徽章墙）
  - 下拉刷新手势触发数据同步
- **优势：** 统一的入口体验，降低学习成本

**2. 返回上一级模式**
- **应用范围：** 所有旅程
- **模式：** 顶部返回按钮或系统返回手势
- **设计原则：**
  - 深层页面显示"返回"按钮（左上角）
  - 保留历史记录，支持返回上一级
- **优势：** 符合用户预期，不会迷失

#### 决策模式（Decision Patterns）

**1. 批量操作确认模式**
- **应用范围：** 职场家长、次要家长、管理员
- **模式：** 批量操作前弹出二次确认对话框
- **设计原则：**
  - 确认对话框显示具体操作内容（"确认批准 10 个任务？+积分：+50 分"）
  - 提供"取消"和"确认"按钮
  - 确认后立即执行，无需二次确认
- **优势：** 防止误操作，同时保持高效

**2. 状态分支模式**
- **应用范围：** 孩子
- **模式：** 根据不同状态显示不同操作选项
- **设计原则：**
  - 任务待完成 → 显示"标记完成"按钮
  - 任务待审批 → 显示"等待家长确认"状态
  - 任务已批准 → 显示"积分已增加"动画
  - 任务已驳回 → 显示"已驳回"状态和原因
- **优势：** 清晰的状态引导，减少用户困惑

#### 反馈模式（Feedback Patterns）

**1. 即时视觉反馈模式**
- **应用范围：** 所有旅程
- **模式：** 操作后立即显示视觉反馈
- **设计原则：**
  - 按钮：点击后立即显示加载状态
  - 成功：显示绿色对勾或庆祝动画
  - 失败：显示红色叉叉和错误提示
  - 音效：关键操作伴随音效（签到叮~！完成任务叮~！）
- **优势：** 增强操作感知，提升用户体验

**2. 进度指示模式**
- **应用范围：** 所有旅程
- **模式：** 显示任务或流程的进度
- **设计原则：**
  - 批量操作：显示"已批准 3/10 个任务"
  - 加载数据：显示旋转加载图标
  - 步骤流程：显示进度条"步骤 2/5：选择模板"
- **优势：** 用户知道当前状态，减少焦虑

---

### Flow Optimization Principles（流程优化原则）

基于 4 个用户旅程的设计，我总结了以下流程优化原则：

#### 原则 1：最小化步骤到价值（Minimize Steps to Value）

**优化目标：** 让用户尽可能快地获得价值

**具体应用：**
- **职场家长：** 一键批量审批（滑动多选 + 长按全选），从 20 分钟缩短到 2 分钟
- **孩子：** 签到自动批（无需家长审批），立即获得积分
- **次要家长：** 首屏显示当前家庭规则，无需点击深层菜单
- **管理员：** 模板列表按年龄分类，快速找到目标模板

**设计原则：**
- 首屏必须显示核心价值（今日概况、快速操作入口）
- 高频操作最多 2 次点击即可完成
- 低频操作可以隐藏在深层菜单，但需提供全局搜索

#### 原则 2：减少认知负荷（Reduce Cognitive Load）

**优化目标：** 每个决策点的信息量最小化

**具体应用：**
- **首次引导：** 5 步流程，每步只展示一个核心信息（创建儿童 → 选择模板 → 设置任务类型 → 查看徽章 → 理解规则）
- **批量操作：** 任务按状态分组（待审批/已完成），减少家长记忆负担
- **愿望兑换：** 显示"距离愿望还差 X 天（基于当前速度）"，无需家长计算

**设计原则：**
- 每屏信息不超过 3 个核心要点
- 复杂信息分步展示（渐进式披露）
- 提供默认选项，减少用户选择

#### 原则 3：提供清晰反馈和进度指示（Provide Clear Feedback and Progress Indicators）

**优化目标：** 用户始终知道自己的状态

**具体应用：**
- **任务审批：** 家长审批后，孩子端 3 秒内看到积分更新（顶部同步指示器 + 音效）
- **任务完成：** 孩子标记任务完成后，立即显示"待家长确认"状态，家长端同步显示待审批任务
- **管理员模板：** 发布前显示"预计影响约 100 个家庭"，让管理员理解操作范围

**设计原则：**
- 所有操作必须有视觉反馈（成功/失败/进行中）
- 关键操作提供进度条或百分比显示
- 错误信息使用用户可理解的语言

#### 原则 4：创造愉悦时刻（Create Moments of Delight）

**优化目标：** 在关键节点创造正向情感体验

**具体应用：**
- **孩子：** 获得徽章时显示庆祝动画（从屏幕中心弹出 + 掌声音效）
- **职场家长：** 复制管理员模板成功后显示烟花效果 + 文案："太棒了！您的任务计划已创建"
- **签到：** 连续签到 7 天后显示特殊庆祝动画 + 额外积分奖励

**设计原则：**
- 关键成就节点必须有庆祝效果（不是简单的提示）
- 动画要流畅但不干扰操作
- 可以分享愉悦时刻（徽章分享到家长微信）

#### 原则 5：优雅处理边缘情况和错误恢复（Handle Edge Cases and Error Recovery Gracefully）

**优化目标：** 异常情况下用户不会卡住

**具体应用：**
- **网络断线：** 孩子端显示离线队列，上线后自动同步（Background Sync API）
- **数据冲突：** 孩子离线操作和家长审批冲突时，提供"保留离线版本"或"使用家长版本"选择
- **任务超时未审批：** 早上 8:00 推送提醒："王浩有 3 个任务待审批，点击快速处理"
- **管理员删除模板：** 已被 25 个家庭引用的模板无法完全删除，提供"下架"选项

**设计原则：**
- 网络状态实时显示（顶部栏绿色/橙色/红色图标）
- 错误信息提供恢复路径（"点击重试"、"联系管理员"）
- 避免用户数据丢失（离线队列 + 定期备份）

---

## Step 11: Component Design Specifications

### Overview

基于前面的设计方向 C（平衡双端型）、4 个用户旅程、Journey Patterns 和 Flow Optimization Principles，本节定义 10 个核心组件的详细设计规范。

**设计原则：**
- 基于 Shadcn UI + Tailwind CSS 技术栈
- 双端适配（儿童平板、家长小程序、管理员 PC）
- 统一的设计语言和交互模式
- 优先考虑可访问性和响应式设计
- 遵循 Journey Patterns 和 Flow Optimization Principles

---

### 1. TaskCard（任务卡片组件）

#### Purpose

任务卡片是展示单个任务的核心组件，用于：
- 儿童端：查看任务状态、标记完成
- 家长端：查看任务详情、审批任务
- 管理员端：编辑模板中的任务项

#### Usage

**使用场景：**
- 任务列表中展示每个任务
- 任务详情弹窗中展示单个任务
- 批量审批模式下展示待选任务

**实现位置：**
- `components/tasks/TaskCard.tsx`
- 依赖：Shadcn UI Card, Button, Badge 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [图标] 任务名称          [状态徽章] │
│ [描述文本（可选）]                 │
│ [积分值]  [完成时间]  [操作按钮]   │
└─────────────────────────────────────┘
```

**结构分解：**
1. **左侧图标区域**（48x48pt）：任务类型图标（刷牙、学习、运动等）
2. **中间内容区域**：
   - 任务名称（h4-bold，14pt）
   - 任务描述（p-regular，12pt，可选）
   - 元信息行：积分值、完成时间
3. **右侧操作区域**：
   - 状态徽章（右上角）
   - 主操作按钮（右下角）
4. **背景/边框**：Shadcn Card 样式，根据状态变化颜色

#### States

| 状态 | 视觉表现 | 儿童端交互 | 家长端交互 |
|------|----------|------------|------------|
| **待完成** | 灰色背景，普通边框 | 点击"标记完成"按钮 | 点击查看详情 |
| **待确认** | 橙色边框，"待家长确认"徽章 | 显示锁定图标，积分待定 | 点击"同意"或"驳回" |
| **已批准** | 绿色背景，绿色对勾图标 | 显示"积分已增加" | 查看历史记录 |
| **已驳回** | 红色背景，红色叉叉图标 | 显示"已驳回" | 点击查看驳回原因 |
| **选中状态** | 蓝色边框，选中背景 | - | 批量操作时显示 |
| **悬浮状态** | 边框变粗，阴影加深 | 显示预览详情 | 显示快速操作菜单 |

#### Variants

**尺寸变体：**
- `default`: 120x80pt（平板纵向列表）
- `compact`: 120x60pt（小程序紧凑列表）
- `large`: 150x100pt（管理员编辑模式，显示更多信息）

**内容变体：**
- `with-description`: 显示任务描述（模板编辑模式）
- `without-description`: 仅显示标题和元信息（儿童端简化）
- `with-timestamp`: 显示完成时间戳（家长端历史记录）

**主题变体：**
- `child`: 大按钮、鲜艳色彩、游戏化图标
- `parent`: 紧凑布局、信息密集、专业色调
- `admin`: 编辑模式、详细信息、高亮关键字段

#### Accessibility

- **键盘导航：** Tab 键遍历卡片，Enter/Space 键激活主操作按钮
- **屏幕阅读器：**
  - `aria-label`：描述任务名称和状态
  - `aria-live="polite"`：状态变化时通知
  - `role="button"`：卡片可点击时
- **触摸目标：** 最小触摸区域 44x44pt（儿童端推荐 80x80pt）
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1
- **焦点状态：** 键盘焦点显示明显的蓝色外框

#### Content Guidelines

**任务名称：**
- 使用动词开头（"刷牙"、"完成作业"、"帮助同学"）
- 长度 ≤ 12 字符（平板），≤ 8 字符（小程序）
- 避免技术术语，使用儿童友好语言

**任务描述：**
- 仅在需要时添加（如复杂任务）
- 长度 ≤ 30 字符
- 使用"完成条件"描述（"独立完成，无需帮助"）

**积分值：**
- 显示为"+5 分"（绿色）
- 位置：右上角或底部左侧
- 避免显示负积分

**状态徽章文案：**
- 待确认："待家长确认"
- 已批准："已批准"
- 已驳回："已驳回"
- 已完成："已完成"

#### Interaction Behavior

**儿童端交互：**
1. 点击"标记完成"按钮：
   - 按钮显示加载状态（500ms）
   - 显示"完成"动画（对勾弹出）
   - 状态变为"待确认"，积分显示为灰色+锁图标
   - 播放音效"叮~！"
2. 点击卡片查看详情：
   - 显示任务详情弹窗
   - 弹窗内可添加备注（可选）
3. 长按卡片（高级交互）：
   - 触发"添加备注"选项

**家长端交互：**
1. 点击卡片：
   - 显示任务详情弹窗
   - 弹窗内显示完成时间、描述、奖励
2. 点击"同意"按钮：
   - 确认对话框："确认批准此任务？+积分：+5 分"
   - 确认后立即执行，无需二次确认
3. 长按卡片（批量选择）：
   - 进入批量选择模式
   - 卡片显示蓝色边框和选中勾选
4. 悬停卡片：
   - 显示快速操作菜单（同意/驳回/详情）

**管理员端交互：**
1. 点击卡片：
   - 进入任务编辑模式
   - 可修改任务名称、积分、关联徽章
2. 拖拽卡片：
   - 调整任务顺序（重新排序）

---

### 2. DashboardWidget（仪表盘组件）

#### Purpose

仪表盘组件是用户登录后首先看到的首页组件，用于：
- 展示今日概况（签到状态、待审批任务、积分变化）
- 快速访问主要功能入口
- 显示关键数据和进度

#### Usage

**使用场景：**
- 所有角色登录后的首页
- 用户快速了解当前状态
- 快速访问高频功能

**实现位置：**
- `components/dashboard/DashboardWidget.tsx`
- 依赖：Shadcn UI Card, Progress, Statistic 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [欢迎信息，用户名称]               │
├─────────────────────────────────────┤
│ [今日签到] [待审批] [积分变化]     │
│  [大卡片]  [大卡片]  [大卡片]      │
├─────────────────────────────────────┤
│ [快速操作入口]                      │
│  [任务列表] [愿望列表] [徽章墙]    │
└─────────────────────────────────────┘
```

**结构分解：**
1. **头部欢迎区域**：
   - 欢迎文案："早上好，李妈妈！" 或 "嗨，王浩！"
   - 当前日期
2. **今日概况卡片组**（横向排列，3 列）：
   - 今日签到：签到状态、连胜计数
   - 待审批任务：数量、快速操作按钮
   - 积分变化：今日积分、总积分
3. **快速操作入口**（横向排列，3 列）：
   - 任务列表：大图标 + 文案
   - 愿望列表：大图标 + 文案
   - 徽章墙：大图标 + 文案

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **加载中** | 显示骨架屏（Skeleton） | 数据加载时 |
| **数据就绪** | 显示完整数据 | 正常状态 |
| **无数据** | 显示空状态提示 | 新用户/无任务时 |
| **错误状态** | 显示错误提示和"重试"按钮 | 网络错误/数据加载失败 |
| **下拉刷新** | 显示旋转刷新图标 | 用户下拉刷新时 |

#### Variants

**角色变体：**
- `child`: 游戏化界面、鲜艳色彩、大按钮、庆祝动画
- `parent`: 专业界面、数据可视化、紧凑布局、批量操作入口
- `admin`: 管理员视图、全局统计、模板管理入口

**尺寸变体：**
- `default`: 标准尺寸（平板/PC）
- `compact`: 紧凑尺寸（小程序）

**主题变体：**
- `light`: 浅色主题（默认）
- `dark`: 深色主题

#### Accessibility

- **语义化结构：** 使用 `<section>` 标签分隔不同区域
- **标题层级：** 欢迎信息使用 `<h1>`，卡片标题使用 `<h2>`
- **屏幕阅读器：**
  - 每个卡片使用 `aria-label` 描述关键数据
  - 快速操作按钮使用 `aria-label` 描述功能
- **键盘导航：** Tab 键遍历卡片，Enter 键激活快速操作
- **焦点顺序：** 逻辑顺序：欢迎 → 今日概况 → 快速操作
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**欢迎文案：**
- 早晨（7:00-12:00）："早上好，[姓名]！"
- 下午（12:00-18:00）："下午好，[姓名]！"
- 晚上（18:00-22:00）："晚上好，[姓名]！"
- 避免使用过于正式的语言

**今日概况卡片文案：**
- 今日签到："已签到"（绿色） / "未签到"（灰色） + 连胜计数："已连续 7 天"
- 待审批任务："3 个任务待审批"（橙色）
- 积分变化："今日 +50 分"（绿色） + 总积分："总积分 850 分"

**快速操作入口文案：**
- 任务列表："我的任务"（儿童端） / "任务列表"（家长端）
- 愿望列表："我的愿望"（儿童端） / "愿望列表"（家长端）
- 徽章墙："徽章墙"

#### Interaction Behavior

**通用交互：**
1. 下拉刷新：
   - 显示旋转刷新图标
   - 刷新完成后播放"叮~"音效
   - 更新所有卡片数据
2. 点击快速操作入口：
   - 导航到对应页面
   - 显示页面切换动画（滑入/滑出）

**儿童端交互：**
1. 签到卡片：
   - 点击签到按钮（大按钮，80x80pt）
   - 显示"已签到"动画（绿色对勾弹出）
   - 积分显示 "+5 分"（数字滚动动画）
   - 播放音效"叮~！"
2. 待审批卡片：
   - 显示"待家长确认"状态
   - 点击显示"提醒家长"按钮
   - 发送通知到家长端
3. 积分卡片：
   - 点击查看积分历史
   - 显示折线图（本周积分趋势）

**家长端交互：**
1. 待审批任务卡片：
   - 点击直接跳转到任务列表
   - 任务列表自动筛选"待审批"状态
   - 显示批量操作入口
2. 积分变化卡片：
   - 点击查看积分明细
   - 显示"今日 vs 上周"对比
   - 高亮"异常"任务（如"今天快速完成了 5 个任务"）
3. 今日签到卡片：
   - 显示儿童签到状态
   - 点击查看签到历史

**管理员端交互：**
1. 今日概况卡片：
   - 显示全局统计
   - 总家庭数、活跃家庭数、平均任务完成率
   - 点击查看详细报表

---

### 3. BatchTaskList（批量任务列表组件）

#### Purpose

批量任务列表组件用于家长端和管理员端高效处理多个任务，支持：
- 滑动多选、长按全选
- 批量同意/驳回
- 智能分组（按状态、按任务类型）
- 批量操作确认

#### Usage

**使用场景：**
- 家长晚上集中审批任务（15-30分钟）
- 管理员批量审核家庭
- 管理员批量删除模板

**实现位置：**
- `components/tasks/BatchTaskList.tsx`
- 依赖：Shadcn UI Checkbox, Button, Drawer 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [筛选标签] 全部 | 待审批 | 已完成  │
├─────────────────────────────────────┤
│ [分组标题] 待审批（10）            │
│  ┌─[✓] TaskCard ──────────────┐   │
│  │ [图标] 任务名称   [状态徽章] │   │
│  └─────────────────────────────┘   │
│  ┌─[✓] TaskCard ──────────────┐   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│ [固定底部操作栏]                    │
│  [全部同意(10)] [全部驳回(10)]    │
└─────────────────────────────────────┘
```

**结构分解：**
1. **顶部筛选标签**：全部、待审批、已完成、已驳回
2. **分组标题**：按状态或任务类型分组，显示数量
3. **任务卡片列表**：每个卡片左侧带复选框
4. **固定底部操作栏**：显示选中数量和操作按钮

#### States

| 状态 | 视觉表现 | 交互 |
|------|----------|------|
| **普通模式** | 卡片无复选框 | 点击卡片查看详情 |
| **批量选择模式** | 卡片显示复选框 | 点击复选框选中，点击卡片查看详情 |
| **全选状态** | 所有复选框被选中 | 长按任意卡片触发全选 |
| **悬浮选中** | 卡片边框变蓝 | 便于确认选中状态 |
| **操作确认中** | 显示加载动画 | 批量操作执行中 |

#### Variants

**分组变体：**
- `by-status`: 按状态分组（待审批、已完成、已驳回）
- `by-type`: 按任务类型分组（日常、学习、运动）
- `by-date`: 按日期分组（今天、昨天、本周）

**布局变体：**
- `default`: 标准布局（竖屏）
- `horizontal`: 横向布局（平板横屏）

**主题变体：**
- `light`: 浅色主题
- `dark`: 深色主题

#### Accessibility

- **键盘导航：**
  - Tab 键遍历卡片
  - Space/Enter 键选中复选框
  - Esc 键退出批量选择模式
- **屏幕阅读器：**
  - 每个分组标题使用 `aria-label` 描述分组名称和数量
  - 选中状态使用 `aria-checked` 属性
- **批量操作提示：**
  - 操作前弹出确认对话框
  - 显示具体操作内容（"确认批准 10 个任务？+积分：+50 分"）
- **焦点状态：** 选中卡片显示蓝色边框

#### Content Guidelines

**分组标题文案：**
- 待审批："待审批（10）"
- 已完成："已完成（5）"
- 已驳回："已驳回（2）"

**底部操作栏文案：**
- 全部同意："全部同意（10）"
- 全部驳回："全部驳回（10）"
- 取消："取消选择"

**确认对话框文案：**
- 同意："确认批准 10 个任务？+ 积分：+50 分"
- 驳回："确认驳回 10 个任务？原因：[输入框]"
- 取消："取消"

#### Interaction Behavior

**批量选择交互：**
1. 长按任意卡片：
   - 进入批量选择模式
   - 所有卡片显示复选框
   - 长按的卡片自动选中
2. 点击复选框：
   - 选中/取消选中
   - 底部操作栏更新选中数量
3. 点击分组标题：
   - 全选/取消全选该组所有任务
4. 点击"全部选择"按钮（左上角）：
   - 全选所有任务
5. 点击"取消选择"按钮：
   - 退出批量选择模式

**批量操作交互：**
1. 点击"全部同意"：
   - 弹出确认对话框
   - 显示具体操作内容（"确认批准 10 个任务？+积分：+50 分"）
   - 点击确认 → 立即执行，显示加载动画
   - 执行完成后显示成功提示
2. 点击"全部驳回"：
   - 弹出确认对话框
   - 显示原因输入框（必填）
   - 点击确认 → 立即执行
3. 批量操作进度：
   - 显示"已批准 3/10 个任务"
   - 完成后播放音效"叮~！"

**滑动多选交互：**
- 向左滑动卡片 → 显示复选框
- 向右滑动卡片 → 显示快捷操作（同意/驳回）

---

### 4. BadgeCard（徽章卡片组件）

#### Purpose

徽章卡片组件用于展示单个徽章，用于：
- 儿童端徽章墙展示
- 徽章详情查看
- 徽章分享

#### Usage

**使用场景：**
- 徽章墙列表中展示徽章
- 徽章详情弹窗中展示大图
- 徽章分享预览

**实现位置：**
- `components/badges/BadgeCard.tsx`
- 依赖：Shadcn UI Card, Avatar, Dialog 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│        [徽章大图标/图片]           │
│          64x64pt                   │
│       徽章名称（14pt bold）        │
│   "连续 7 天刷牙"（12pt）         │
│   [获得时间] [为什么获得]         │
│   [分享按钮]                       │
└─────────────────────────────────────┘
```

**结构分解：**
1. **徽章图标/图片区域**（64x64pt）：居中显示徽章
2. **徽章名称**（14pt bold）：徽章标题
3. **徽章描述**（12pt）：为什么获得徽章
4. **获得时间**（12pt gray）：获得日期
5. **操作按钮**：分享、查看详情

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **已获得** | 彩色徽章，完整显示 | 用户已获得 |
| **未获得** | 灰色徽章，半透明显示 | 未获得，显示锁定图标 |
| **预览中** | 徽章高亮，显示阴影 | 悬停/点击查看详情 |
| **分享中** | 显示分享选项菜单 | 点击分享按钮 |

#### Variants

**尺寸变体：**
- `default`: 100x100pt（徽章墙列表）
- `large`: 150x150pt（徽章详情）
- `small`: 60x60pt（任务关联徽章）

**状态变体：**
- `earned`: 已获得（彩色）
- `locked`: 未获得（灰色）

**主题变体：**
- `light`: 浅色主题
- `dark`: 深色主题

#### Accessibility

- **键盘导航：** Tab 键遍历徽章，Enter 键查看详情
- **屏幕阅读器：**
  - `aria-label`：描述徽章名称和状态
  - `aria-live="polite"`：获得新徽章时通知
- **焦点状态：** 键盘焦点显示蓝色外框
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**徽章名称：**
- 使用描述性名称（"连续 7 天刷牙"、"学习小标兵"）
- 长度 ≤ 8 字符
- 避免抽象词汇

**徽章描述：**
- 说明"为什么获得"徽章（"连续 7 天刷牙 - 证明你有坚持的力量！"）
- 关联行为和价值
- 长度 ≤ 30 字符

**获得时间：**
- 显示格式："2026-02-11 获得"
- 未获得时显示："未获得"

#### Interaction Behavior

**查看详情：**
1. 点击徽章卡片：
   - 显示徽章详情弹窗
   - 弹窗内显示：
     - 徽章大图（120x120pt）
     - 徽章名称和描述
     - "为什么获得"说明
     - "累计 7 天，完成 7 个任务"
     - 表情："小助手"说："王浩太棒了！"
     - 获得时间

**分享徽章：**
1. 点击"分享"按钮：
   - 显示分享选项菜单
   - 选项：分享到家长微信、复制图片、复制文本
   - 选择后执行分享操作

**悬停效果：**
- 徽章阴影加深
- 边框变粗

**获得新徽章：**
- 显示庆祝动画（从屏幕中心弹出）
- 播放掌声音效
- 显示"恭喜获得新徽章！"提示

---

### 5. WishCard（愿望卡片组件）

#### Purpose

愿望卡片组件用于展示单个愿望，用于：
- 儿童端查看愿望列表和进度
- 家长端审核愿望
- 管理员端查看家庭愿望统计

#### Usage

**使用场景：**
- 愿望列表中展示愿望
- 愿望详情弹窗中展示
- 仪表盘显示当前愿望进度

**实现位置：**
- `components/wishes/WishCard.tsx`
- 依赖：Shadcn UI Card, Progress, Button 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [愿望图片/图标] 愿望名称 [状态徽章] │
│ [愿望描述]                          │
│ ━━━━●━━━━━━━━━━ 85%               │
│ "还差 20 分可兑换"（12pt）         │
│ [操作按钮：兑换/编辑/删除]         │
└─────────────────────────────────────┘
```

**结构分解：**
1. **左侧图片/图标区域**（60x60pt）：愿望图片或图标
2. **右上角状态徽章**：已兑换、待兑换、已取消
3. **愿望名称**（14pt bold）
4. **愿望描述**（12pt）
5. **进度条**：显示当前积分 vs 目标积分
6. **进度文案**："还差 X 分可兑换"
7. **操作按钮**：兑换、编辑、删除

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **待兑换** | 蓝色边框，进度条显示进度 | 积分未达到目标 |
| **可兑换** | 绿色边框，"可兑换"徽章 | 积分已达到目标 |
| **已兑换** | 绿色背景，"已兑换"徽章 | 已成功兑换 |
| **已取消** | 灰色背景，"已取消"徽章 | 已被取消 |
| **悬浮状态** | 边框变粗，阴影加深 | 悬停效果 |

#### Variants

**尺寸变体：**
- `default`: 120x100pt（列表）
- `compact`: 120x80pt（紧凑列表）
- `large`: 150x120pt（详情）

**状态变体：**
- `pending`: 待兑换
- `ready`: 可兑换
- `redeemed`: 已兑换
- `cancelled`: 已取消

**主题变体：**
- `light`: 浅色主题
- `dark`: 深色主题

#### Accessibility

- **键盘导航：** Tab 键遍历卡片，Enter 键激活主操作按钮
- **屏幕阅读器：**
  - `aria-label`：描述愿望名称和状态
  - `aria-live="polite"`：愿望状态变化时通知
- **触摸目标：** 最小触摸区域 44x44pt
- **焦点状态：** 键盘焦点显示蓝色外框
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**愿望名称：**
- 使用物品名称或活动名称（"乐高"、"游乐园"）
- 长度 ≤ 12 字符
- 避免抽象概念

**愿望描述：**
- 简短描述愿望内容（"乐高 LEGO 10252 10243"）
- 长度 ≤ 30 字符

**进度文案：**
- 可兑换："可以兑换了！"
- 待兑换："还差 X 分可兑换"
- 已兑换："已兑换 2026-02-11"

#### Interaction Behavior

**兑换愿望：**
1. 点击"兑换"按钮（仅可兑换时可用）：
   - 弹出确认对话框："确认兑换？扣除积分：100 分"
   - 点击确认 → 立即兑换
   - 显示成功动画（积分扣除动画）
   - 播放音效"叮~！"

**编辑愿望：**
1. 点击"编辑"按钮：
   - 显示编辑弹窗
   - 可修改愿望名称、描述、图片、积分要求
   - 点击保存 → 立即更新

**删除愿望：**
1. 点击"删除"按钮：
   - 弹出确认对话框："确认删除此愿望？"
   - 点击确认 → 立即删除

**查看详情：**
1. 点击卡片：
   - 显示愿望详情弹窗
   - 弹窗内显示完整信息

**家长审核：**
1. 家长端点击"审核"按钮：
   - 显示审核弹窗
   - 可同意/驳回愿望
   - 可添加备注

---

### 6. TemplatePreviewCard（模板预览卡片组件）

#### Purpose

模板预览卡片组件用于管理员和家长浏览模板，用于：
- 管理员模板列表展示
- 家长浏览和复制管理员模板
- 模板预览（未来 7 天/30 天任务分布）

#### Usage

**使用场景：**
- 管理员模板管理页面
- 家长首次使用引导流程（第 2 步）
- 模板详情预览

**实现位置：**
- `components/templates/TemplatePreviewCard.tsx`
- 依赖：Shadcn UI Card, Button, Dialog 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [模板名称]          [适用年龄段]    │
│ [模板描述]                          │
│ [任务分布预览]                      │
│  ┌───┬───┬───┬───┬───┬───┬───┐    │
│  │ 2 │ 3 │ 1 │ 4 │ 2 │ 5 │ 1 │    │
│  └───┴───┴───┴───┴───┴───┴───┘    │
│ [积分统计] 总积分：35 分/周         │
│ [徽章关联] 关联 3 个徽章            │
│ [大按钮] 立即使用此模板             │
└─────────────────────────────────────┘
```

**结构分解：**
1. **模板名称**（16pt bold）
2. **适用年龄段徽章**（右上角）：6-8 岁、9-12 岁
3. **模板描述**（12pt）
4. **任务分布预览**：未来 7 天任务分布（每日任务数量）
5. **积分统计**：总积分/周
6. **徽章关联**：关联的徽章数量和名称
7. **操作按钮**："立即使用此模板"（大按钮）

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **草稿** | 灰色边框，"草稿"徽章 | 仅管理员可见 |
| **已发布** | 蓝色边框，"已发布"徽章 | 家长可见 |
| **已下架** | 灰色背景，"已下架"徽章 | 家长不可见 |
| **已复制** | 绿色边框，"已复制"徽章 | 家长已复制此模板 |

#### Variants

**尺寸变体：**
- `default`: 200x150pt（模板列表）
- `large`: 250x180pt（模板详情预览）

**状态变体：**
- `draft`: 草稿
- `published`: 已发布
- `unpublished`: 已下架
- `copied`: 已复制

**角色变体：**
- `admin`: 管理员视图（编辑、发布、删除）
- `parent`: 家长视图（预览、复制）

#### Accessibility

- **键盘导航：** Tab 键遍历卡片，Enter 键激活主操作按钮
- **屏幕阅读器：**
  - `aria-label`：描述模板名称和状态
- **触摸目标：** 最小触摸区域 44x44pt（"立即使用"按钮 80x80pt）
- **焦点状态：** 键盘焦点显示蓝色外框
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**模板名称：**
- 使用描述性名称（"6-8 岁儿童日常习惯养成计划"）
- 长度 ≤ 16 字符

**模板描述：**
- 简短描述模板内容和目标（"培养良好的日常习惯，包括刷牙、整理房间、完成作业等"）
- 长度 ≤ 40 字符

**任务分布预览：**
- 显示未来 7 天每日任务数量
- 使用网格布局

**操作按钮文案：**
- 家长端："立即使用此模板"
- 管理员端："编辑模板"、"发布模板"、"删除模板"

#### Interaction Behavior

**家长端交互：**
1. 点击模板卡片：
   - 显示模板详情弹窗
   - 弹窗内显示完整任务日历视图（未来 7 天/30 天）
2. 点击"立即使用此模板"按钮：
   - 弹出确认对话框："确认复制此模板？5 分钟内开始使用"
   - 点击确认 → 复制模板
   - 显示庆祝动画（简单烟花效果）
   - 文案："太棒了！您的任务计划已创建，现在添加孩子吧"
3. 点击"预览"按钮：
   - 显示任务日历视图（未来 7 天）
   - 可切换到 30 天视图

**管理员端交互：**
1. 点击模板卡片：
   - 进入模板编辑模式
2. 点击"发布"按钮：
   - 弹出确认对话框："发布后，所有家长都能看到此模板"
   - 显示"预计影响约 100 个家庭"
   - 点击确认 → 发布模板
3. 点击"删除"按钮：
   - 引用计数检查：
     - 如果 reference_count > 0：
       - 提示："已有 25 个家庭复制了此模板，无法完全删除。是否标记为下架？"
       - 选择"下架"：对家长隐藏
     - 如果 reference_count = 0：
       - 确认删除

---

### 7. SigninButton（签到按钮组件）

#### Purpose

签到按钮组件用于儿童端每日签到，用于：
- 孩子每日签到获得积分
- 显示连胜计数
- 游戏化激励（签到奖励）

#### Usage

**使用场景：**
- 儿童端首页仪表盘
- 儿童端单独签到页面
- 仪表盘今日签到卡片

**实现位置：**
- `components/auth/SigninButton.tsx`
- 依赖：Shadcn UI Button, Badge 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│         [大圆按钮 80x80pt]          │
│           [签到图标]                │
│           "签到"                    │
├─────────────────────────────────────┤
│      连续签到 7 天 [连胜火焰图标]   │
└─────────────────────────────────────┘
```

**结构分解：**
1. **大圆按钮**（80x80pt）：签到图标 + "签到"文案
2. **连胜计数**：连续签到天数 + 连胜火焰图标

#### States

| 状态 | 视觉表现 | 交互 |
|------|----------|------|
| **未签到** | 蓝色按钮，"签到"文案 | 点击签到 |
| **已签到** | 灰色按钮，"已签到"文案 | 点击查看签到历史 |
| **加载中** | 显示旋转加载图标 | 签到请求中 |
| **连胜奖励** | 黄色按钮，"连胜奖励"徽章 | 显示额外积分奖励 |

#### Variants

**尺寸变体：**
- `large`: 80x80pt（首页）
- `medium`: 60x60pt（卡片内）
- `small`: 40x40pt（迷你）

**主题变体：**
- `child`: 儿童端（大按钮、鲜艳色彩）
- `parent`: 家长端（小按钮、查看儿童签到）

#### Accessibility

- **键盘导航：** Tab 键聚焦，Enter/Space 键激活
- **屏幕阅读器：**
  - `aria-label`：描述签到状态和连胜计数
  - `aria-live="polite"`：签到状态变化时通知
- **触摸目标：** 最小触摸区域 80x80pt
- **焦点状态：** 键盘焦点显示蓝色外框
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**按钮文案：**
- 未签到："签到"
- 已签到："已签到"

**连胜计数文案：**
- "连续签到 X 天"
- "已连续签到 X 天"

**连胜奖励文案：**
- "连胜 7 天奖励 +10 分！"
- "连胜 14 天奖励 +20 分！"

#### Interaction Behavior

**签到：**
1. 点击"签到"按钮：
   - 按钮显示加载状态（500ms）
   - 显示"签到成功"动画（绿色对勾弹出）
   - 积分显示 "+5 分"（数字滚动动画）
   - 播放音效"叮~！"
   - 按钮状态变为"已签到"（灰色）
   - 连胜计数更新

**查看签到历史：**
1. 点击已签到按钮：
   - 显示签到历史弹窗
   - 显示最近 30 天签到记录
   - 高亮连胜记录

**连胜奖励：**
- 连续签到 7 天：显示"连胜 7 天奖励 +10 分！"动画
- 连续签到 14 天：显示"连胜 14 天奖励 +20 分！"动画
- 播放特殊音效（掌声）
- 显示庆祝动画（彩虹效果）

---

### 8. ComboIndicator（Combo 指示器组件）

#### Purpose

Combo 指示器组件用于展示连续完成任务的情况，用于：
- 儿童端显示 Combo 状态和奖励
- 家长端查看孩子的 Combo 记录
- 游戏化激励（ Combo 奖励）

#### Usage

**使用场景：**
- 儿童端首页仪表盘
- 儿童端任务列表
- 家长端成长曲线页面

**实现位置：**
- `components/combos/ComboIndicator.tsx`
- 依赖：Shadcn UI Badge, Progress 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [火焰图标] Combo 7 天连胜          │
│ ━━━━●━━━━━━━━━━ 70%               │
│ "下级奖励：连续 10 天奖励 +20 分" │
│ [今日进度] 已完成 3/4 任务         │
└─────────────────────────────────────┘
```

**结构分解：**
1. **Combo 图标**：火焰图标（随连胜天数变化大小/颜色）
2. **Combo 状态文案**："Combo X 天连胜"
3. **进度条**：距离下级奖励的进度
4. **下级奖励文案**："连续 X 天奖励 +X 分"
5. **今日进度**：已完成任务数量 / 总任务数量

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **未激活** | 灰色火焰，"未激活" | 0 天 |
| **激活** | 橙色火焰，"Combo X 天" | 1-6 天 |
| **中级奖励** | 黄色火焰，"Combo X 天" | 7-13 天 |
| **高级奖励** | 红色火焰，"Combo X 天" | 14+ 天 |
| **即将中断** | 橙色闪烁，"今日任务未完成" | 风险警告 |

#### Variants

**尺寸变体：**
- `default`: 200x80pt（仪表盘）
- `compact`: 150x60pt（列表）

**主题变体：**
- `child`: 儿童端（大图标、鲜艳色彩）
- `parent`: 家长端（信息密集）

#### Accessibility

- **屏幕阅读器：**
  - `aria-label`：描述 Combo 状态和奖励
  - `aria-live="polite"`：Combo 状态变化时通知
- **颜色对比：** 文本与背景对比度 ≥ 4.5:1

#### Content Guidelines

**Combo 状态文案：**
- "Combo 7 天连胜"
- "未激活"（0 天）

**下级奖励文案：**
- "连续 10 天奖励 +20 分"
- "连续 20 天奖励 +50 分"

**即将中断文案：**
- "今日任务未完成，Combo 即将中断"
- "加油！完成任务保持连胜"

#### Interaction Behavior

**查看 Combo 详情：**
1. 点击 Combo 指示器：
   - 显示 Combo 详情弹窗
   - 显示 Combo 历史记录
   - 显示奖励规则
   - 显示"为什么 Combo 重要"说明

**Combo 中断：**
- 任务未完成 → Combo 中断
- 显示中断提示："Combo 中断了没关系，今天就是新的开始！"
- 播放遗憾音效
- 连胜计数重置

**Combo 奖励：**
- 达到 7 天：显示"Combo 7 天奖励 +10 分！"动画
- 达到 14 天：显示"Combo 14 天奖励 +20 分！"动画
- 播放特殊音效（火焰音效）
- 显示庆祝动画（火焰特效）

---

### 9. SyncIndicator（同步指示器组件）

#### Purpose

同步指示器组件用于显示数据同步状态，用于：
- 实时显示网络连接状态
- 显示数据同步进度
- 错误状态提示和重试

#### Usage

**使用场景：**
- 顶部状态栏（所有端）
- 数据加载页面
- 离线队列同步

**实现位置：**
- `components/sync/SyncIndicator.tsx`
- 依赖：Shadcn UI Icon, Badge 组件

#### Anatomy

```
┌─────────────────────────────────────┐
│ [绿色对勾] 已同步 2 秒前            │
└─────────────────────────────────────┘

或

┌─────────────────────────────────────┐
│ [橙色旋转图标] 正在同步...          │
└─────────────────────────────────────┘

或

┌─────────────────────────────────────┐
│ [红色叉叉] 同步失败 [点击重试按钮]  │
└─────────────────────────────────────┘
```

**结构分解：**
1. **状态图标**：绿色对勾 / 橙色旋转图标 / 红色叉叉
2. **状态文案**：已同步 X 秒前 / 正在同步... / 同步失败
3. **操作按钮**：点击重试（仅错误状态）

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **已同步** | 绿色对勾，"已同步 X 秒前" | 数据已同步 |
| **正在同步** | 橙色旋转图标，"正在同步..." | 同步进行中 |
| **同步失败** | 红色叉叉，"同步失败" | 网络错误/冲突 |
| **离线模式** | 灰色图标，"离线" | 无网络连接 |

#### Variants

**位置变体：**
- `top-bar`: 顶部状态栏（固定）
- `inline`: 行内显示（在组件内）
- `floating`: 悬浮按钮（右下角）

**主题变体：**
- `light`: 浅色主题
- `dark`: 深色主题

#### Accessibility

- **屏幕阅读器：**
  - `aria-live="polite"`：同步状态变化时通知
  - `aria-label`：描述同步状态
- **键盘导航：** Tab 键聚焦，Enter 键激活重试按钮
- **焦点状态：** 键盘焦点显示蓝色外框

#### Content Guidelines

**状态文案：**
- 已同步："已同步 X 秒前"
- 正在同步："正在同步..."
- 同步失败："同步失败"
- 离线模式："离线"

**操作按钮文案：**
- "点击重试"

#### Interaction Behavior

**下拉刷新：**
- 下拉顶部状态栏 → 立即同步最新数据
- 显示旋转刷新图标
- 同步完成后播放"叮~"音效
- 更新状态为"已同步"

**点击重试：**
- 点击"同步失败"状态 → 立即重试同步
- 显示加载动画

**离线队列同步：**
- 上线后自动同步离线队列
- 显示"正在同步离线操作..."提示
- 同步完成后显示"已同步 X 个离线操作"

**冲突处理：**
- 显示冲突提示："您离线操作与家长审批冲突"
- 提供"保留离线版本"或"使用家长版本"选择

---

### 10. CelebrationAnimation（庆祝动画组件）

#### Purpose

庆祝动画组件用于在关键成就节点显示庆祝效果，用于：
- 获得新徽章
- Combo 达到新高度
- 愿望兑换成功
- 任务完成

#### Usage

**使用场景：**
- 获得新徽章后
- Combo 达到 7 天/14 天
- 愿望兑换成功
- 任务完成

**实现位置：**
- `components/animations/CelebrationAnimation.tsx`
- 依赖：Shadcn UI Dialog 组件，CSS 动画

#### Anatomy

```
┌─────────────────────────────────────┐
│                                    │
│      [烟花/彩虹/火焰动画]          │
│                                    │
│     "恭喜获得新徽章！"              │
│     "连续 7 天刷牙"                │
│                                    │
│      [大按钮：太棒了！]             │
│                                    │
└─────────────────────────────────────┘
```

**结构分解：**
1. **动画区域**：全屏覆盖或模态弹窗
2. **庆祝文案**："恭喜获得新徽章！" / "Combo 7 天达成！" / "愿望兑换成功！"
3. **详细描述**："连续 7 天刷牙" / "已连续完成任务 7 天" / "已兑换乐高"
4. **关闭按钮**："太棒了！" / "确定"

#### States

| 状态 | 视觉表现 | 说明 |
|------|----------|------|
| **播放中** | 全屏动画覆盖 | 动画播放中 |
| **显示按钮** | 动画完成后显示关闭按钮 | 可关闭 |

#### Variants

**类型变体：**
- `badge`: 徽章获得（烟花效果）
- `combo`: Combo 达成（火焰特效）
- `wish`: 愿望兑换（彩虹效果）
- `task`: 任务完成（对勾弹出）

**尺寸变体：**
- `fullscreen`: 全屏覆盖
- `modal`: 模态弹窗

#### Accessibility

- **屏幕阅读器：**
  - `aria-live="assertive"`：重要成就通知
  - `aria-label`：描述庆祝内容
- **键盘导航：** Tab 键聚焦关闭按钮，Enter/Space 键关闭
- **焦点状态：** 键盘焦点显示蓝色外框
- **动画控制：** 提供设置选项（减少动画）

#### Content Guidelines

**庆祝文案：**
- 徽章："恭喜获得新徽章！"
- Combo："Combo X 天达成！"
- 愿望："愿望兑换成功！"

**详细描述：**
- 徽章："连续 7 天刷牙 - 证明你有坚持的力量！"
- Combo："已连续完成任务 X 天，太棒了！"
- 愿望："已兑换 [愿望名称]，积分已扣除"

**关闭按钮文案：**
- "太棒了！"（儿童端）
- "确定"（家长端）

#### Interaction Behavior

**自动播放：**
- 触发事件后自动播放动画
- 动画时长：3-5 秒
- 播放音效（可关闭）

**关闭动画：**
- 点击"太棒了！"按钮 → 关闭动画
- 点击背景 → 关闭动画
- ESC 键 → 关闭动画

**动画类型：**
- 徽章获得：烟花效果（粒子从中心向外扩散）
- Combo 达成：火焰特效（火焰从底部向上燃烧）
- 愿望兑换：彩虹效果（彩虹弧形出现）
- 任务完成：对勾弹出（绿色对勾从中心弹出）

**音效：**
- 徽章：掌声 + "叮~！"
- Combo：火焰音效
- 愿望：彩虹音效
- 任务：叮~！

---

## 设计规范总结

### 组件复用原则

基于 Journey Patterns 和 Flow Optimization Principles，本节定义的 10 个组件实现了：
1. **统一的设计语言**：所有组件基于 Shadcn UI + Tailwind CSS，确保一致性
2. **双端适配**：所有组件支持儿童端（平板）、家长端（小程序）、管理员端（PC）
3. **游戏化与效率平衡**：儿童端游戏化元素丰富，家长端效率优先
4. **可访问性优先**：所有组件支持键盘导航、屏幕阅读器、触摸目标
5. **响应式设计**：所有组件支持响应式断点（tablet: 768px, mini-program: 450px, desktop: 1024px）

### 设计令牌

**颜色系统：**
- 主色调：蓝色系（儿童友好）
- 成功色：绿色（积分增加、任务完成）
- 警告色：橙色（待审批、同步中）
- 错误色：红色（同步失败、操作失败）
- 中性色：灰色（禁用、已归档）

**间距系统：**
- 基础单位：4px
- 规则：4、8、16、24、32、48px

**字体系统：**
- 标题：14pt bold
- 正文：12pt regular
- 小字：10pt regular

**触摸目标：**
- 最小：44x44pt
- 推荐：80x80pt（儿童端）

---

## 🎉 Workflow Completion

Congratulations! The UX Design Specification for **Family Reward** has been successfully completed.

---

### ✅ Completed Steps

| Step | Description | Status |
|-------|-------------|--------|
| 1 | Initialization | ✅ Completed |
| 2 | UX Discovery (Project Understanding) | ✅ Completed |
| 3 | Emotional Response | ✅ Completed |
| 4 | Inspiration Analysis | ✅ Completed |
| 5 | Design System Choice | ✅ Completed |
| 6 | Visual Foundation | ✅ Completed |
| 7 | Core Experience Definition | ⏭️ Skipped (similar to Step 3) |
| 8 | Design Directions | ✅ Completed |
| 9 | Design Directions | ✅ Completed |
| 10 | User Journey Flows | ✅ Completed |
| 11 | Component Strategy | ✅ Completed |
| 12 | UX Consistency Patterns | ⏭️ Skipped (covered in Step 10) |
| 13 | Responsive & Accessibility | ⏭️ Skipped (covered in Step 9 & 11) |
| 14 | Complete | ✅ Completed |

---

### 📊 Document Summary

**Total Steps:** 14
**Completed Steps:** 11 (Steps 7, 12, 13 were skipped due to duplication/coverage in other steps)
**Skipped Steps:** 3

**Document Sections:**
1. Executive Summary (Project Vision, Target Users, Key Design Challenges, Design Opportunities)
2. Pre-mortem Analysis (Failure Scenarios & Prevention Measures)
3. Minor vs Primary Parent Differences
4. Admin Template Publishing Flow
5. Design Directions (3 design approaches with selected recommendation)
6. User Journey Flows (4 user journeys with Mermaid diagrams)
7. Journey Patterns (Navigation, Decision, Feedback patterns)
8. Flow Optimization Principles (5 key principles)
9. Component Specifications (10 custom components with full design specs)

**Total Lines:** 2580+

---

### 🎯 Design Highlights

**Design System:** Shadcn UI + Tailwind CSS
**Design Direction:** Balance Dual-Platform (Child gamified + Parent efficient)
**Platform Support:** Tablet (child), Mini-program (parent), Desktop (admin)
**Responsive Breakpoints:** Tablet 768px, Mini-program 450px, Desktop 1024px
**Color System:** Blue-based primary, Green success, Orange warning, Red error, Gray neutral

---

### 🚀 Next Steps

The UX Design Specification is now complete and ready for:
1. **Wireframe Generation** - Create low-fidelity layouts based on component specs
2. **Interactive Prototyping** - Build clickable prototypes for user testing
3. **Solution Architecture** - Technical design with UX context
4. **Epic Creation** - Break down work for development teams

---

**[END OF UX DESIGN SPECIFICATION]**

